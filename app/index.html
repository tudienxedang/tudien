<!DOCTYPE html>
<html lang="vi" prefix="og: https://ogp.me/ns#">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Hệ thống học tiếng xơ đăng cho học sinh THCS | Ứng dụng PWA miễn phí</title>
    <meta name="description" content="Hệ thống học tiếng Xơ Đăng trực tuyến dành riêng cho học sinh THCS. Từ điển tương tác, bài học sinh động, trắc nghiệm thông minh, trò chơi giáo dục. Ứng dụng PWA học offline, hỗ trợ phát âm chuẩn, hoàn toàn miễn phí.">
    <meta name="keywords" content="học tiếng xơ đăng, tiếng xê đăng, học tiếng dân tộc thiểu số, từ điển xơ đăng, ứng dụng học tiếng xơ đăng, học tiếng xơ đăng online, bài tập tiếng xơ đăng, pwa học tiếng dân tộc, tiếng xơ đăng cho học sinh, giáo dục dân tộc thiểu số, bảo tồn ngôn ngữ dân tộc">

	<!-- Additional SEO Meta -->
	<meta name="thumbnail" content="https://tudienxedang.github.io/tudien/Thumnail.jpg">
	<meta property="og:updated_time" content="2025-12-26T00:00:00+07:00">
	<meta property="og:locale:alternate" content="vi_VN">
	<meta property="og:locale:alternate" content="en_US">

	<!-- Additional Twitter Meta -->
	<meta name="twitter:domain" content="tudienxedang.github.io">
	<meta name="twitter:site:id" content="@hocxodang">

	<!-- Article Meta (nếu có blog) -->
	<meta property="article:published_time" content="2025-12-26T00:00:00+07:00">
	<meta property="article:modified_time" content="2025-12-26T00:00:00+07:00">
	<meta property="article:author" content="Trường THCS Chu Văn An">
	<meta property="article:section" content="Giáo dục">
	<meta property="article:tag" content="tiếng xơ đăng, học tiếng dân tộc">
	<meta name="author" content="Trường THCS Chu Văn An, Đăk Hà, Quảng Ngãi">
    <meta name="copyright" content="Dự án KHKT Học sinh THCS">
    <meta name="language" content="Vietnamese">
    <meta name="revisit-after" content="7 days">
    
    <!-- PWA Manifest - GIỮ NGUYÊN -->
    <link rel="manifest" href="https://tudienxedang.github.io/tudien/manifest.json">
    <meta name="theme-color" content="#27ae60">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Học Tiếng Xơ Đăng THCS">
    <link rel="apple-touch-icon" href="/icon-192x192.png">

    <!-- Open Graph - CẬP NHẬT -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tudienxedang.github.io/tudien/">
    <meta property="og:title" content="Hệ thống hỗ trợ học tiếng Xơ Đăng trên nền tảng PWA cho học sinh THCS">
    <meta property="og:description" content="Ứng dụng PWA học tiếng Xơ Đăng miễn phí dành cho học sinh THCS. Từ điển tương tác, bài học sinh động, hỗ trợ phát âm chuẩn.">
    <meta property="og:image" content="https://tudienxedang.github.io/tudien/Thumnail.jpg">
	<meta property="og:image:secure_url" content="https://tudienxedang.github.io/tudien/Thumnail.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Học sinh THCS học tiếng Xơ Đăng trên điện thoại">
    <meta property="og:locale" content="vi_VN">
    <meta property="og:site_name" content="Học Tiếng Xơ Đăng THCS">
    
    <!-- Twitter Card - CẬP NHẬT -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@hocxodang">
    <meta name="twitter:creator" content="@hocxodang">
    <meta name="twitter:title" content="Hệ thống hỗ trợ học tiếng Xơ Đăng trên nền tảng PWA cho học sinh THCS">
    <meta name="twitter:description" content="Ứng dụng PWA học tiếng Xơ Đăng miễn phí - Từ điển tương tác, bài học sinh động">
    <meta name="twitter:image" content="https://tudienxedang.github.io/tudien/Thumnail.jpg">
    
    <!-- Performance Optimization -->
    <link rel="preconnect" href="https://sheets.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
	<!-- Preload critical resources -->
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" as="style">
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" as="style" crossorigin>
<!-- === HẾT PHẦN PRELOAD === -->
    
    <!-- Canonical & Sitemap -->
    <link rel="canonical" href="https://tudienxedang.github.io/tudien/">
    <link rel="sitemap" type="application/xml" href="https://tudienxedang.github.io/tudien/sitemap.xml">
    
    <!-- Favicon - GIỮ NGUYÊN -->
    <link rel="icon" type="image/png" href="https://tudienxedang.github.io/tudien/favicon.png">
    
    <!-- === SCHEMA MARKUP MỚI - QUAN TRỌNG CHO AI CỦA GOOGLE === -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Hệ thống hỗ trợ học tiếng Xơ Đăng trên nền tảng PWA cho học sinh THCS",
        "description": "Ứng dụng web tiến bộ (PWA) hỗ trợ học sinh THCS học tiếng Xơ Đăng thông qua từ điển tương tác, bài học sinh động và trò chơi giáo dục",
        "url": "https://tudienxedang.github.io/tudien/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "VND"
        },
        "author": {
            "@type": "EducationalOrganization",
            "name": "Trường THCS Chu Văn An",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "Đăk Hà",
                "addressRegion": "Quảng Ngãi",
                "addressCountry": "VN"
            }
        },
        "audience": {
            "@type": "EducationalAudience",
            "educationalRole": "student",
            "audienceType": "SecondarySchoolStudents"
        },
        "featureList": [
            "Từ điển Xơ Đăng - Việt tương tác",
            "Bài học tiếng Xơ Đăng có phát âm",
            "Hệ thống trắc nghiệm thông minh",
            "Trò chơi học tập tương tác",
            "Hỗ trợ học offline",
            "Công cụ đóng góp từ vựng"
        ],
        "softwareVersion": "2.0",
        "datePublished": "2025-12-26",
        "dateModified": "2025-12-26"
    }
    
    
    <!-- Schema cho khóa học -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Course",
        "name": "Khóa học tiếng Xơ Đăng cho học sinh THCS",
        "description": "Khóa học tiếng Xơ Đăng trực tuyến miễn phí dành cho học sinh trung học cơ sở",
        "provider": {
            "@type": "Organization",
            "name": "Trường THCS Chu Văn An"
        },
        "teaches": "Tiếng Xơ Đăng (ngôn ngữ dân tộc thiểu số)",
        "timeRequired": "P30H",
        "hasCourseInstance": {
            "@type": "CourseInstance",
            "courseMode": "online"
        }
    }
    </script>
	<!-- === THÊM: Breadcrumb Schema === -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Trang chủ",
      "item": "https://tudienxedang.github.io/tudien/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Học tiếng Xơ Đăng",
      "item": "https://tudienxedang.github.io/tudien/#home"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Từ điển Xơ Đăng - Việt",
      "item": "https://tudienxedang.github.io/tudien/#home"
    }
  ]
}
</script>

<!-- === THÊM: FAQ Schema === -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Học tiếng Xơ Đăng có miễn phí không?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Có, hệ thống học tiếng Xơ Đăng này hoàn toàn miễn phí cho học sinh THCS, được phát triển từ đề tài KHKT."
      }
    },
    {
      "@type": "Question",
      "name": "Có thể học offline không?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Có, đây là ứng dụng PWA (Progressive Web App) có thể cài đặt và học offline sau lần đầu truy cập."
      }
    },
    {
      "@type": "Question",
      "name": "Hệ thống có bao nhiêu từ vựng?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Hiện tại hệ thống có hơn 1000 từ vựng tiếng Xơ Đăng - Việt, kèm phát âm và ví dụ minh họa."
      }
    },
    {
      "@type": "Question",
      "name": "Đối tượng sử dụng là ai?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Hệ thống được thiết kế chuyên biệt cho học sinh THCS, đặc biệt tại các vùng có đồng bào dân tộc Xơ Đăng sinh sống."
      }
    },
    {
      "@type": "Question",
      "name": "Có tính năng trợ giúp phát âm không?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Có, mỗi từ vựng đều có file âm thanh phát âm chuẩn, kèm tính năng nhận diện giọng nói để luyện phát âm."
      }
    }
  ]
}
</script>

	<!-- === THÊM: Organization Schema === -->
<script type="application/ld+json">
	{
	  "@context": "https://schema.org",
	  "@type": "EducationalOrganization",
	  "name": "Trường THCS Chu Văn An - Đăk Hà",
	  "description": "Trường THCS Chu Văn An tại xã Đăk Hà, tỉnh Quảng Ngãi, nơi phát triển hệ thống học tiếng Xơ Đăng cho học sinh",
	  "url": "https://tudienxedang.github.io/tudien/",
	  "address": {
		"@type": "PostalAddress",
		"addressLocality": "Đăk Hà",
		"addressRegion": "Quảng Ngãi",
		"addressCountry": "VN"
	  },
	  "contactPoint": {
		"@type": "ContactPoint",
		"email": "baotruongminh201@gmail.com",
		"contactType": "customer support"
	  },
	  "sameAs": [
		"https://facebook.com/your_facebook_page",
		"https://zalo.me/your_zalo_id"
	  ]
	}
</script>
    
    <!-- Font Awesome - GIỮ NGUYÊN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Tailwind CSS - GIỮ NGUYÊN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Tất cả CSS từ phiên bản trước vẫn giữ nguyên */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #27ae60;
            --accent-color: #e74c3c;
            --example-color: #c0392b;
            --text-color: #000000;
            --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --transition-speed: 0.3s;
            --chat-primary: #27ae60;
            --chat-secondary: #2ecc71;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-gradient);
            line-height: 1.6;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .navbar {
            background: rgba(255,255,255,0.98);
            padding: 0.8rem 1rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
            width: 100%;
        }
        .navbar ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .menu-link, .menu-button {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.5;
            transition: all var(--transition-speed);
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }
        .menu-link:hover, .menu-button:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .container {
            background: rgba(255,255,255,0.98);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            padding: 1.8rem;
            max-width: 1200px;
            margin: 1.5rem auto;
            backdrop-filter: blur(10px);
            display: none;
            opacity: 0;
            transition: opacity var(--transition-speed);
            width: 95%;
            flex: 1;
        }
        .container.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1, h2 { text-align: center; margin-bottom: 1.2rem; }
        h1 { 
            font-size: 2rem; 
            color: var(--primary-color);
            position: relative;
            padding-bottom: 0.8rem;
        }
        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: var(--secondary-color);
            border-radius: 2px;
        }
        h2 { 
            font-size: 1.6rem; 
            color: var(--secondary-color);
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 0.5rem;
            font-weight: 700; /* ĐẬM CHỮ */
        }
        .intro-content {
            padding: 1.5rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            text-align: center;
        }
        .intro-content p { 
            margin-bottom: 1rem;
            text-align: justify;
            color: var(--text-color);
        }
        .intro-content ul, .intro-content ol {
            list-style: none;
            padding: 0;
            margin: 1rem auto;
            max-width: 800px;
            text-align: left;
            display: inline-block;
        }
        .intro-content li {
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 1.5rem;
            position: relative;
            color: var(--text-color);
        }
        .intro-content li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--secondary-color);
            font-weight: bold;
        }
        .intro-content li i {
            margin-right: 0.5rem;
            color: var(--secondary-color);
            min-width: 20px;
            text-align: center;
        }
        .feature-image {
            text-align: center;
            margin: 1.5rem 0;
        }
        .feature-image img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            loading: lazy;
            border: 1px solid #e0e0e0;
        }
        #searchForm {
            display: grid;
            gap: 1rem;
            grid-template-columns: 1fr auto auto;
            margin-bottom: 1.5rem;
        }
        .input-group { display: grid; gap: 0.5rem; }
        .form-label { 
            font-weight: 600; 
            color: #e74c3c !important; /* MÀU ĐỎ - ĐÃ SỬA */
            font-size: 0.95rem;
            text-align: left;
        }
        input[type="text"], select {
            padding: 0.8rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all var(--transition-speed);
            color: var(--text-color);
        }
        input[type="text"]:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.15);
            outline: none;
        }
        button {
            padding: 0.8rem 1.8rem;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all var(--transition-speed);
            font-family: inherit;
        }
        button:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #speechButton {
            padding: 0.8rem;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
        }
        #speechButton:hover {
            background: #219653;
            transform: translateY(-2px);
        }
        #speechButton.listening {
            background: var(--accent-color);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        .result-container {
            margin-top: 1.5rem;
            padding: 1.8rem;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            min-height: 200px;
        }
        .word-card {
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.04);
            margin-bottom: 1rem;
            text-align: center;
        }
        .word-card:last-child {
            margin-bottom: 0;
        }
        .highlight-word {
            font-weight: bold;
            color: var(--example-color);
            font-size: 1.5em;
            display: inline-block;
            margin: 0.2rem 0;
            text-align: center;
            width: 100%;
        }
        .word-text {
            color: var(--text-color);
            text-align: center;
        }
        .error {
            color: #e74c3c;
            padding: 1rem;
            background: #fdeded;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #e74c3c;
            text-align: center;
        }
        
        .audio-player-container {
            margin-top: 1.2rem;
            padding: 1.2rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }
        
        .audio-player-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.05rem;
        }
        
        .drive-audio-player {
            width: 100%;
            height: 80px;
            border: none;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .drive-player-wrapper {
            position: relative;
            width: 100%;
            min-height: 80px;
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
            margin-bottom: 0.5rem;
        }
        
        .audio-info {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
            text-align: center;
            font-style: italic;
        }
        
        .example-section {
            margin-top: 1.2rem;
            padding: 1.2rem;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e9 100%);
            border-radius: 10px;
            border: 1px solid #d4edda;
            text-align: center;
        }
        
        .example-title {
            font-weight: 600;
            color: var(--example-color);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.05rem;
        }
        
        .example-content {
            margin: 0.5rem 0;
            text-align: center;
        }
        
        .example-viet {
            color: var(--text-color);
            font-size: 1.05rem;
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background: #f0f8f0;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
            text-align: center;
        }
        
        .example-ethnic {
            color: var(--example-color);
            font-size: 1.05rem;
            font-weight: 600;
            padding: 0.8rem;
            background: #f5f5f5;
            border-radius: 6px;
            border-left: 4px solid var(--example-color);
            text-align: center;
        }
        
        .example-label {
            font-weight: 600;
            color: var(--text-color);
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .search-button {
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0.8rem 2.5rem;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
            background: #27ae60;
            color: white !important;
            font-weight: 600;
        }
        
        .search-button:hover {
            background: #219653;
        }
        
        .search-input-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            #searchForm { 
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            .search-button {
                max-width: 100%;
                width: 100%;
            }
            .container { 
                padding: 1.2rem;
                margin: 1rem auto;
                width: 98%;
            }
            button { 
                width: 100%;
                margin-top: 0.5rem;
            }
            .navbar ul {
                gap: 0.8rem;
            }
            .menu-link, .menu-button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .drive-audio-player {
                height: 70px;
            }
            h1 {
                font-size: 1.7rem;
            }
            h2 {
                font-size: 1.4rem;
            }
            .intro-content li {
                justify-content: center;
            }
            /* CSS cho giao diện phát âm trên điện thoại */
            .audio-player-container {
                padding: 1rem;
            }
            .drive-player-wrapper {
                margin: 0.5rem 0;
            }
            .drive-audio-player {
                height: 60px;
            }
            /* Tăng khoảng cách giữa các nút điều khiển */
            .audio-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            .audio-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        .footer {
            background: rgba(255,255,255,0.98);
            padding: 1.5rem 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            position: relative;
            z-index: 10;
            text-align: center;
            width: 100%;
            margin-top: auto;
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        .footer-content p {
            margin: 0.5rem 0;
            color: var(--primary-color);
            font-size: 0.95rem;
            text-align: center;
        }
        .hashtag-container {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }
        .hashtag {
            display: inline-block;
            margin: 0.3rem;
            padding: 0.5rem 1rem;
            background: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: all var(--transition-speed);
            font-size: 0.85rem;
            text-align: center;
        }
        .hashtag:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        .contact-title {
            display: inline-block;
            margin: 1rem 0;
            padding: 0.5rem 1.2rem;
            background: var(--secondary-color);
            color: white;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            text-align: center;
        }
        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-top: 0.8rem;
        }
        .social-icons a {
            color: var(--secondary-color);
            font-size: 1.4rem;
            transition: all var(--transition-speed);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f0f7ff;
            text-align: center;
        }
        .social-icons a:hover {
            color: white;
            background: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        body.dark-mode {
            --primary-color: #ecf0f1;
            --secondary-color: #27ae60;
            --accent-color: #e74c3c;
            --example-color: #e74c3c;
            --text-color: #ecf0f1;
            --background-gradient: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }
        body.dark-mode .navbar {
            background: rgba(44,62,80,0.98);
        }
        body.dark-mode .container {
            background: rgba(44,62,80,0.98);
            color: var(--text-color);
        }
        body.dark-mode .intro-content {
            background: #34495e;
            border-color: #4a6278;
        }
        body.dark-mode .result-container {
            background: #2c3e50;
            border-color: #4a6278;
        }
        body.dark-mode .word-card {
            background: #34495e;
        }
        body.dark-mode .error {
            background: #e74c3c;
            color: white;
            border-left-color: #c0392b;
        }
        body.dark-mode .footer {
            background: rgba(44,62,80,0.98);
        }
        body.dark-mode .audio-info {
            background: #2c3e50;
            color: #ecf0f1;
        }
        body.dark-mode .example-section {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-color: #4a6278;
        }
        body.dark-mode .audio-player-container {
            background: #34495e;
            border-color: #4a6278;
        }
        body.dark-mode .drive-player-wrapper {
            background: #2c3e50;
            border-color: #4a6278;
        }
        body.dark-mode .example-viet {
            background: #2c3e50;
            color: var(--text-color);
            border-left-color: #27ae60;
        }
        body.dark-mode .example-ethnic {
            background: #34495e;
            color: var(--example-color);
            border-left-color: var(--example-color);
        }
        body.dark-mode .word-text {
            color: var(--text-color);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--secondary-color);
            font-size: 1.1rem;
        }
        
        .no-result {
            color: var(--primary-color);
            text-align: center;
            padding: 2rem;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px dashed #ddd;
        }
        
        .word-item {
            margin-bottom: 1.2rem;
            padding-bottom: 1.2rem;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            text-align: center;
        }
        
        .word-item:last-child {
            border-bottom: none;
        }
        
        .pronunciation {
            color: #666;
            font-style: italic;
            margin-top: 0.3rem;
            font-size: 0.95rem;
            background: #f0f0f0;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
        }
        
        body.dark-mode .pronunciation {
            background: #3a506b;
            color: #bdc3c7;
        }
        
        .dictionary-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 0.3rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        body.dark-mode .stat-item {
            background: #34495e;
            border-color: #4a6278;
        }
        
        body.dark-mode .stat-label {
            color: #bdc3c7;
        }
        
        main {
            flex: 1;
            width: 100%;
        }
        
        /* Phần đóng góp mới */
        .contribute-tabs {
            display: flex;
            background: #e9ecef;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 1.5rem;
            gap: 5px;
        }
        
        .contribute-tab {
            flex: 1;
            text-align: center;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .contribute-tab.active {
            background: white;
            color: var(--secondary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .contribute-tab:not(.active):hover {
            background: rgba(255,255,255,0.5);
            color: #333;
        }
        
        .contribute-form {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .form-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
            outline: none;
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .audio-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .record-btn {
            background: #e74c3c;
            color: white;
        }
        
        .record-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .record-btn.recording {
            background: #c0392b;
            animation: pulse 1.5s infinite;
        }
        
        .upload-btn {
            background: #27ae60;
            color: white;
        }
        
        .upload-btn:hover {
            background: #219653;
            transform: translateY(-2px);
        }
        
        .single-playback-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem; /* TĂNG KHOẢNG CÁCH GIỮA CÁC NÚT */
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .single-play-btn {
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 50%;
            width: 50px; /* TĂNG KÍCH THƯỚC */
            height: 50px; /* TĂNG KÍCH THƯỚC */
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem; /* TĂNG KÍCH THƯỚC ICON */
        }
        
        .single-play-btn:hover {
            background: #219653;
            transform: scale(1.1);
        }
        
        .single-play-btn.playing {
            background: #e74c3c;
        }
        
        .single-delete-btn {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 50%;
            width: 50px; /* TĂNG KÍCH THƯỚC */
            height: 50px; /* TĂNG KÍCH THƯỚC */
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem; /* TĂNG KÍCH THƯỚC ICON */
        }
        
        .single-delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .single-stop-btn {
            background: #f39c12;
            color: white;
            padding: 10px 20px;
            border-radius: 50%;
            width: 50px; /* TĂNG KÍCH THƯỚC */
            height: 50px; /* TĂNG KÍCH THƯỚC */
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem; /* TĂNG KÍCH THƯỚC ICON */
        }
        
        .single-stop-btn:hover {
            background: #d68910;
            transform: scale(1.1);
        }
        
        .audio-visualizer {
            width: 100%;
            height: 60px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 1rem;
            overflow: hidden;
            position: relative;
            border: 1px solid #e9ecef;
        }
        
        .audio-wave {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .audio-wave-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: var(--secondary-color);
            border-radius: 2px 2px 0 0;
            transition: height 0.1s ease;
        }
        
        .queue-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
        }
        
        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 5px;
            border-left: 3px solid var(--secondary-color);
        }
        
        .queue-item:last-child {
            margin-bottom: 0;
        }
        
        .queue-item-info {
            flex: 1;
        }
        
        .queue-item-name {
            font-weight: 500;
            color: #333;
        }
        
        .queue-item-size {
            font-size: 0.8rem;
            color: #666;
        }
        
        .queue-item-actions {
            display: flex;
            gap: 10px; /* TĂNG KHOẢNG CÁCH GIỮA CÁC NÚT */
        }
        
        .queue-play-btn {
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 50%; /* LÀM TRÒN */
            width: 40px; /* TĂNG KÍCH THƯỚC */
            height: 40px; /* TĂNG KÍCH THƯỚC */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem; /* TĂNG KÍCH THƯỚC ICON */
        }
        
        .queue-play-btn.playing {
            background: #e74c3c;
        }
        
        .queue-play-btn.playing i {
            transform: translateX(1px);
        }
        
        .queue-delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%; /* LÀM TRÒN */
            width: 40px; /* TĂNG KÍCH THƯỚC */
            height: 40px; /* TĂNG KÍCH THƯỚC */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem; /* TĂNG KÍCH THƯỚC ICON */
        }
        
        .submit-contribute-btn {
            width: 100%;
            padding: 12px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .submit-contribute-btn:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .audio-status {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            min-height: 20px;
        }
        
        .current-playing {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        body.dark-mode .contribute-tabs {
            background: #34495e;
        }
        
        body.dark-mode .contribute-tab.active {
            background: #2c3e50;
            color: var(--secondary-color);
        }
        
        body.dark-mode .contribute-form {
            background: #2c3e50;
            border-color: #4a6278;
        }
        
        body.dark-mode .form-input {
            background: #34495e;
            border-color: #4a6278;
            color: #ecf0f1;
        }
        
        body.dark-mode .audio-visualizer {
            background: #34495e;
            border-color: #4a6278;
        }
        
        body.dark-mode .queue-item {
            background: #34495e;
            border-left-color: var(--secondary-color);
        }
        
        body.dark-mode .queue-item-name {
            color: #ecf0f1;
        }
        
        body.dark-mode .queue-item-size {
            color: #bdc3c7;
        }
        
        .word-display {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            align-items: center;
            text-align: center;
        }
        
        .word-display-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            align-items: center;
            text-align: center;
            width: 100%;
        }
        
        .word-display-label {
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            width: 100%;
        }
        
        .word-display-value {
            font-size: 1.1rem;
            padding-left: 0;
            text-align: center;
            width: 100%;
        }
        
        /* Hiệu ứng phát âm thanh cho hàng đợi */
        .playing-wave {
            animation: wave 0.5s infinite alternate;
        }
        
        @keyframes wave {
            from { height: 20%; }
            to { height: 80%; }
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.success {
            background: #27ae60;
        }
        
        .toast.error {
            background: #e74c3c;
        }
        
        .toast.info {
            background: #3498db;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        /* Tìm kiếm thông minh */
        .search-status {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 0.5rem;
            min-height: 20px;
        }
        
        .exact-match {
            border-left-color: #27ae60 !important;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e9 100%);
        }
        
        body.dark-mode .exact-match {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }
        
        .match-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        .exact-match-type {
            background: #27ae60;
            color: white;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .word-card {
            animation: slideIn 0.3s ease;
        }
        
        /* Căn chỉnh cho các tính năng */
        .features-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        /* Hình ảnh dân tộc Xơ Đăng */
        .ethnic-image-container {
            width: 100%;
            max-width: 800px;
            margin: 2rem auto;
            text-align: center;
        }
        
        .ethnic-image {
            width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: 3px solid var(--secondary-color);
        }
        
        .image-caption {
            margin-top: 1rem;
            font-style: italic;
            color: var(--text-color);
            font-size: 0.9rem;
            text-align: center;
        }
        
        /* Cải thiện hiển thị từ vựng */
        .vocabulary-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .vocabulary-item {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1.2rem;
            border-radius: 10px;
            border-left: 5px solid var(--secondary-color);
            width: 100%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .vocabulary-item.dark {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }
        
        .language-label {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 0.3rem;
            font-size: 1.1rem;
        }
        
        .language-value {
            font-size: 1.3rem;
            color: var(--text-color);
            font-weight: 600;
        }
        
        /* Google Drive Audio Player Styles - ẨN HOÀN TOÀN ICON ÂM THANH */
        .drive-audio-player {
            width: 100%;
            height: 80px;
            border: none;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .drive-player-wrapper {
            position: relative;
            width: 100%;
            min-height: 80px;
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
            margin-bottom: 0.5rem;
        }
        
        body.dark-mode .drive-player-wrapper {
            background: #2c3e50;
            border-color: #4a6278;
        }
        
        /* Ẩn hoàn toàn icon volume trong audio player */
        .audio-player-title i.fa-volume-up,
        .audio-player-title .fas.fa-volume-up {
            display: none !important;
        }
        
        /* Nút tra cứu màu xanh đậm */
        .search-button {
            background: #27ae60;
        }
        
        .search-button:hover {
            background: #219653;
        }
        
        /* Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #27ae60;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Thêm style cho trạng thái loading của show-more */
        .show-more-loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: var(--secondary-color);
        }
        
        /* Tăng chiều rộng của select hướng dịch */
        #direction {
            min-width: 220px; /* TĂNG CHIỀU RỘNG */
        }
        
        @media (max-width: 768px) {
            #direction {
                min-width: 100%; /* Trên điện thoại sẽ chiếm full width */
                width: 100%;
            }
        }
        
        /* Cải thiện giao diện phát âm trên điện thoại */
        @media (max-width: 480px) {
            .single-playback-controls {
                gap: 1rem; /* Giảm khoảng cách trên màn hình rất nhỏ */
            }
            
            .single-play-btn,
            .single-stop-btn,
            .single-delete-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .queue-play-btn,
            .queue-delete-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }
        
        /* Style cho thông tin file âm thanh đã thu - HIỆN RÕ HƠN */
        #singleAudioFileName {
            color: #27ae60 !important;
            font-weight: bold !important;
            font-size: 1rem !important;
            background-color: #f0f8f0;
            padding: 8px 12px !important;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
            display: inline-block;
            margin-left: 10px !important;
            min-width: 200px;
            text-align: center;
        }
        
        .audio-success-message {
            color: #27ae60;
            font-weight: bold;
            background-color: #f0f8f0;
            padding: 10px;
            border-radius: 6px;
            border: 2px solid #27ae60;
            text-align: center;
            margin-top: 10px;
        }
        
        /* Style cho thông báo âm thanh trong tab từ đơn */
        .audio-status.success {
            color: #27ae60 !important;
            font-weight: bold !important;
            background-color: #f0f8f0;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #27ae60;
        }
        
        /* ===== CHAT WIDGET STYLES ===== */
        .chat-widget-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9998;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .chat-toggle-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--chat-primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            transition: all 0.3s ease;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        .chat-toggle-btn:hover {
            background: var(--chat-secondary);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .chat-toggle-btn .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }
        
        .chat-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .chat-window.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        
        .chat-header {
            background: var(--chat-primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 15px 15px 0 0;
        }
        
        .chat-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-header h3 i {
            font-size: 1.3rem;
        }
        
        .close-chat-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.2s;
        }
        
        .close-chat-btn:hover {
            transform: scale(1.2);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            animation: messageAppear 0.3s ease;
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--chat-primary);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message.bot {
            align-self: flex-start;
            background: white;
            color: #333;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
            background: white;
            border-radius: 18px;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 0.95rem;
            outline: none;
            transition: border 0.3s;
            /* FIX: Giảm chiều dài trên điện thoại */
            max-width: calc(100% - 50px);
        }
        
        .chat-input:focus {
            border-color: var(--chat-primary);
        }
        
        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--chat-primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all 0.3s;
            flex-shrink: 0; /* Ngăn nút bị co lại */
        }
        
        .send-btn:hover:not(:disabled) {
            background: var(--chat-secondary);
            transform: scale(1.05);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .welcome-message {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        
        .welcome-message h4 {
            color: var(--chat-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Dark mode for chat */
        body.dark-mode .chat-window {
            background: #2c3e50;
        }
        
        body.dark-mode .chat-header {
            background: #27ae60;
        }
        
        body.dark-mode .chat-messages {
            background: #34495e;
        }
        
        body.dark-mode .message.bot {
            background: #34495e;
            color: #ecf0f1;
        }
        
        body.dark-mode .typing-indicator {
            background: #34495e;
            color: #ecf0f1;
        }
        
        body.dark-mode .chat-input-container {
            background: #2c3e50;
            border-top-color: #4a6278;
        }
        
        body.dark-mode .chat-input {
            background: #34495e;
            border-color: #4a6278;
            color: #ecf0f1;
        }
        
        body.dark-mode .welcome-message {
            background: #34495e;
            color: #ecf0f1;
        }
        
        @media (max-width: 480px) {
            .chat-window {
                width: 300px;
                height: 450px;
                bottom: 80px;
                right: 10px;
            }
            
            .chat-toggle-btn {
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }
            
            /* FIX: Điều chỉnh chat input trên điện thoại */
            .chat-input-container {
                padding: 10px;
                gap: 8px;
            }
            
            .chat-input {
                padding: 10px 12px;
                font-size: 0.9rem;
                max-width: calc(100% - 45px); /* Giảm chiều rộng trên điện thoại */
            }
            
            .send-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        /* ===== HỌC VÀ KIỂM TRA STYLES (GỘP ÔN TẬP VÀ TRẮC NGHIỆM) ===== */
        .study-quiz-topic-selection {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .study-quiz-topic-selection h2 {
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .study-quiz-topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .study-quiz-topic-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }
        
        .study-quiz-topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, #e8f5e9 0%, #d4edda 100%);
        }
        
        .study-quiz-topic-card.active {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
        }
        
        .study-quiz-topic-card i {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .study-quiz-topic-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        
        .study-quiz-topic-card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Study Interface (Ôn tập) */
        .study-interface {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }
        
        .study-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .study-info {
            flex: 1;
            min-width: 200px;
        }
        
        #currentStudyTopicTitle {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.4rem;
        }
        
        .study-progress {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
            background: #e8f5e9;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        .study-stats {
            font-size: 1.1rem;
            font-weight: 600;
            color: #3498db;
            background: #e3f2fd;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Flashcard styles - ĐÃ SỬA: THÊM ÂM THANH VÀ NỔI BẬT HƠN */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 2rem auto;
        }
        
        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .flashcard-front {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: 3px solid white;
        }
        
        .flashcard-back {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: rotateY(180deg);
            border: 3px solid white;
        }
        
        .flashcard-question {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 0 1rem;
        }
        
        .flashcard-answer {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 1rem;
            padding: 0 1rem;
        }
        
        /* THÊM NỘI DUNG CÂU HỎI KHI LẬT THẺ */
        .flashcard-question-full {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
            padding: 0 1rem;
        }
        
        .flashcard-instruction {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 2rem;
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
        }
        
        /* Tick mark khi lật thẻ */
        .flashcard-tick {
            position: absolute;
            top: 15px;
            right: 15px;
            color: white;
            background: rgba(0, 0, 0, 0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .flashcard-tick.visible {
            opacity: 1;
        }
        
        /* ===== THÊM SỐ THỨ TỰ THẺ VÀ HIỆU ỨNG HOÀN THÀNH - ĐÃ SỬA LỖI HIỂN THỊ ===== */
        .flashcard-number {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            background: rgba(0, 0, 0, 0.25);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        /* FIX: Không áp dụng transform: rotateY(180deg) cho .flashcard-back .flashcard-number */
        /* Thay vào đó, chúng ta sẽ xử lý bằng JavaScript */
        
        .flashcard-number.completed {
            background: rgba(39, 174, 96, 0.9);
            animation: pulseNumber 1.5s ease-in-out;
        }
        
        @keyframes pulseNumber {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Hiệu ứng hoàn thành ôn tập */
        .flashcard.completed-card {
            animation: cardCompleted 1s ease;
        }
        
        @keyframes cardCompleted {
            0% { transform: scale(1); }
            25% { transform: scale(1.05) rotateY(5deg); }
            50% { transform: scale(1.08) rotateY(-5deg); }
            75% { transform: scale(1.05) rotateY(5deg); }
            100% { transform: scale(1) rotateY(0deg); }
        }
        
        /* Hiệu ứng chuyển thẻ */
        .flashcard.next-card {
            animation: nextCardSlide 0.5s ease;
        }
        
        @keyframes nextCardSlide {
            from { 
                opacity: 0; 
                transform: translateX(30px) rotateY(10deg);
            }
            to { 
                opacity: 1; 
                transform: translateX(0) rotateY(0deg);
            }
        }
        
        .flashcard.prev-card {
            animation: prevCardSlide 0.5s ease;
        }
        
        @keyframes prevCardSlide {
            from { 
                opacity: 0; 
                transform: translateX(-30px) rotateY(-10deg);
            }
            to { 
                opacity: 1; 
                transform: translateX(0) rotateY(0deg);
            }
        }
        
        /* Hiệu ứng khi học xong một thẻ */
        .card-completion-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(39, 174, 96, 0.3) 0%, transparent 70%);
            border-radius: 15px;
            opacity: 0;
            z-index: 1;
            pointer-events: none;
        }
        
        .card-completion-effect.active {
            animation: completionGlow 1.5s ease;
        }
        
        @keyframes completionGlow {
            0% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1.3); }
        }
        
        .flashcard-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .flashcard-nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .flashcard-nav-btn:hover {
            background: #219653;
            transform: scale(1.1);
        }
        
        .flashcard-nav-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .flashcard-flip-btn {
            background: #3498db;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .flashcard-flip-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        /* Study progress */
        .study-progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 2rem 0;
            overflow: hidden;
        }
        
        .study-progress-fill {
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        /* Start quiz button */
        .start-quiz-btn {
            display: block;
            margin: 2rem auto 0;
            padding: 1rem 2.5rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .start-quiz-btn:hover {
            background: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .start-quiz-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Quiz Interface (Trắc nghiệm) */
        .quiz-interface {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .quiz-info {
            flex: 1;
            min-width: 200px;
        }
        
        #currentQuizTopicTitle {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.4rem;
        }
        
        .quiz-progress {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
            background: #e8f5e9;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        .quiz-timer {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e74c3c;
            background: #fdeded;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .question-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }
        
        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            line-height: 1.5;
            text-align: center;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            background: #f0f7ff;
            border-color: #c3dafe;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #d4edda;
            border-color: var(--secondary-color);
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .option input {
            transform: scale(1.3);
        }
        
        .option-label {
            font-weight: 600;
            color: var(--secondary-color);
            min-width: 30px;
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .quiz-control-btn {
            padding: 0.8rem 2rem;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
        }
        
        .quiz-control-btn:hover:not(:disabled) {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quiz-control-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .submit-btn {
            background: #e74c3c;
        }
        
        .submit-btn:hover:not(:disabled) {
            background: #c0392b;
        }
        
        /* Quiz Result */
        .quiz-result {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .result-header h2 {
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        #resultTopic {
            color: #666;
            font-size: 1.1rem;
            margin-top: 0.5rem;
        }
        
        .score-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            font-size: 3.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
            position: relative;
        }
        
        .score-circle small {
            font-size: 1.5rem;
            position: absolute;
            bottom: 30px;
            right: -20px;
        }
        
        .score-text {
            flex: 1;
            min-width: 300px;
        }
        
        #resultTitle {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }
        
        #resultDescription {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .result-details {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #f0f0f0;
        }
        
        .result-details h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .detail-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.2rem;
            border-left: 4px solid #ddd;
        }
        
        .detail-item.correct {
            border-left-color: #27ae60;
            background: #f0f8f0;
        }
        
        .detail-item.incorrect {
            border-left-color: #e74c3c;
            background: #fdeded;
        }
        
        .detail-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .detail-answer {
            font-size: 0.95rem;
            color: #666;
        }
        
        .detail-answer.correct {
            color: #27ae60;
            font-weight: 600;
        }
        
        .detail-answer.incorrect {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .result-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .result-action-btn {
            padding: 0.8rem 1.5rem;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
            justify-content: center;
        }
        
        .result-action-btn:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* Animation for correct/incorrect answers */
        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes incorrectAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }
        
        .option.correct-animation {
            animation: correctAnswer 0.5s ease;
        }
        
        .option.incorrect-animation {
            animation: incorrectAnswer 0.5s ease;
        }
        
        /* Dark mode adjustments */
        body.dark-mode .study-quiz-topic-selection,
        body.dark-mode .study-interface,
        body.dark-mode .quiz-interface,
        body.dark-mode .quiz-result {
            background: #2c3e50;
        }
        
        body.dark-mode .study-quiz-topic-card {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border-color: #4a6278;
        }
        
        body.dark-mode .study-quiz-topic-card:hover {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
        }
        
        body.dark-mode .question-container {
            background: #34495e;
            border-color: #4a6278;
        }
        
        body.dark-mode .option {
            background: #2c3e50;
            border-color: #4a6278;
            color: #ecf0f1;
        }
        
        body.dark-mode .option:hover {
            background: #3a506b;
        }
        
        body.dark-mode .detail-item {
            background: #34495e;
            color: #ecf0f1;
        }
        
        body.dark-mode .flashcard-front {
            background: linear-gradient(135deg, #2c3e50, #34495e);
        }
        
        body.dark-mode .flashcard-back {
            background: linear-gradient(135deg, #34495e, #2c3e50);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .study-header,
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .quiz-controls {
                flex-direction: column;
            }
            
            .quiz-control-btn {
                width: 100%;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .result-action-btn {
                width: 100%;
            }
            
            .score-container {
                flex-direction: column;
                text-align: center;
            }
            
            .flashcard-container {
                height: 250px;
            }
            
            .flashcard-front, .flashcard-back {
                padding: 1.5rem;
            }
            
            .flashcard-question {
                font-size: 1.2rem;
            }
            
            .flashcard-answer {
                font-size: 1.5rem;
            }
            
            .flashcard-question-full {
                font-size: 1rem;
            }
            
            .flashcard-number {
                font-size: 0.9rem;
                padding: 4px 8px;
                min-width: 50px;
            }
        }

        /* Install App Button */
        





		
        .offline-indicator {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 9999;
            background: #f39c12;
            color: white;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .offline-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .offline-indicator.online {
            background: #27ae60;
        }

        /* Hướng dẫn học tập mới */
        .study-guide {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 5px solid #2196f3;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.15);
        }
        
        .study-guide h3 {
            color: #1976d2;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .guide-steps {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .guide-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            transition: transform 0.3s;
        }
        
        .guide-step:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .step-number {
            background: #2196f3;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-content h4 {
            color: #1976d2;
            margin-bottom: 0.3rem;
            font-size: 1.1rem;
        }
        
        .step-content p {
            color: #37474f;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .study-tip {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            border: 2px solid #4caf50;
            text-align: center;
        }
        
        .study-tip p {
            color: #2e7d32;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        body.dark-mode .study-guide {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            border-left-color: #3949ab;
        }
        
        body.dark-mode .study-guide h3 {
            color: #7986cb;
        }
        
        body.dark-mode .guide-step {
            background: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .guide-step:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .step-content p {
            color: #e3f2fd;
        }
        
        body.dark-mode .study-tip {
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
            border-color: #4caf50;
        }
        
        body.dark-mode .study-tip p {
            color: #c8e6c9;
        }
        
        /* ===== FIXES CHO DARK MODE VÀ HIỂN THỊ KẾT QUẢ ===== */
        /* FIX: Màu chữ trong input tìm kiếm ở dark mode */
        body.dark-mode input[type="text"],
        body.dark-mode select {
            color: #ffffff !important;
            background-color: #34495e;
        }
        
        body.dark-mode input[type="text"]::placeholder {
            color: #bdc3c7 !important;
        }
        
        /* FIX: Cải thiện hiển thị kết quả tìm kiếm */
        .word-display-item {
            margin-bottom: 1.2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        body.dark-mode .word-display-item {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .highlight-word {
            font-size: 2rem;
            color: #e74c3c;
            margin: 0.5rem 0;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .highlight-word {
            color: #ff6b6b;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .word-text {
            font-size: 1.8rem;
            color: #27ae60;
            font-weight: 600;
            margin: 0.5rem 0;
        }
        
        body.dark-mode .word-text {
            color: #2ecc71;
        }
        
        .pronunciation {
            font-size: 1.2rem;
            color: #7f8c8d;
            font-style: italic;
            background: #f8f9fa;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        body.dark-mode .pronunciation {
            color: #bdc3c7;
            background: #34495e;
            border-left-color: #3498db;
        }
        
        /* FIX: Sắp xếp lại thứ tự hiển thị trong kết quả tìm kiếm */
        .word-display {
            gap: 1.5rem;
        }
        
        /* FIX: Đồng bộ font chữ và kích thước */
        .word-display-label {
            font-size: 1rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        body.dark-mode .word-display-label {
            color: #ecf0f1;
        }
        
        /* FIX: Cải thiện card kết quả */
        .word-card {
            border-left: 6px solid #27ae60;
            transition: all 0.3s ease;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .word-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* FIX: Icon trong kết quả tìm kiếm */
        .word-display-label i {
            color: #27ae60;
            font-size: 1.2rem;
        }
        
        body.dark-mode .word-display-label i {
            color: #2ecc71;
        }
        
        /* FIX: Audio player trong dark mode */
        body.dark-mode .drive-audio-player {
            background: #2c3e50;
        }
        
        /* FIX: Ví dụ minh họa */
        .example-viet, .example-ethnic {
            font-size: 1.1rem;
            line-height: 1.6;
            padding: 1rem;
        }
        
        /* FIX: Đảm bảo tính nhất quán trên mobile */
        @media (max-width: 768px) {
            .highlight-word {
                font-size: 1.8rem;
            }
            
            .word-text {
                font-size: 1.6rem;
            }
            
            .pronunciation {
                font-size: 1.1rem;
            }
            
            .word-display-label {
                font-size: 0.9rem;
            }
        }

        /* Giữ nguyên transform của mặt sau */
.flashcard-back .flashcard-number {
    transform: none !important;
}

/* Style cho phần game */
.game-container {
    width: 100%;
    height: 80vh;
    border: none;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.game-back-button {
    margin-bottom: 20px;
    padding: 12px 24px;
    background: var(--secondary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0 auto 20px auto;
}

.game-back-button:hover {
    background: #219653;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
}

.game-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 300px;
    color: var(--secondary-color);
    font-size: 1.2rem;
}

.game-loading .spinner {
    margin-bottom: 20px;
}
}
   
/* === SEO OPTIMIZATION === */
/* Critical CSS */
.critical-content {
  content-visibility: auto;
  contain-intrinsic-size: 1000px;
}

/* Font loading optimization */
@font-face {
  font-family: 'JakartaSans';
  font-display: swap;
  src: url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
}

/* Reduce CLS (Cumulative Layout Shift) */
.navbar, .footer {
  position: sticky;
  z-index: 100;
}

/* Optimize images */
img[loading="lazy"] {
  content-visibility: auto;
}
/* === HẾT PHẦN CSS THÊM === */

      /* === CSS MỚI: NÚT CÀI ĐẶT & MODAL & THẺ CẢNH BÁO === */

        /* 1. Nút cài đặt (Góc Trái - Đẹp mắt - Luôn hiện) */
        .install-button {
            position: fixed;
            bottom: 20px;
            left: 20px !important; /* Bắt buộc nằm trái */
            right: auto !important; 
            z-index: 9997;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
            transition: all 0.3s ease;
            
            /* SỬA LỖI ẨN NÚT: Đặt opacity là 1 */
            opacity: 1 !important; 
            transform: translateY(0) !important;
            pointer-events: all !important;
            
            animation: float-btn 3s ease-in-out infinite;
        }

        @keyframes float-btn {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        .install-button:hover {
            transform: translateY(-6px) scale(1.05);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.6);
        }

        /* Chỉnh sửa hiển thị trên điện thoại */
        @media (max-width: 768px) {
            .install-button {
                bottom: 85px; /* Tránh bị che */
                left: 15px !important;
                padding: 10px 16px;
                font-size: 0.85rem;
                max-width: 150px;
                white-space: nowrap;
                overflow: hidden;
            }
        }

        /* 2. Modal (Hộp thoại) Phong cách Hiện đại */
        .install-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .install-modal[style*="display: flex"] {
            opacity: 1;
            visibility: visible;
        }

        .install-modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .install-modal-card {
            position: relative;
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 24px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10001;
        }

        .install-modal[style*="display: flex"] .install-modal-card {
            transform: translateY(0);
        }

        .modal-close-btn {
            position: absolute;
            top: 15px; right: 15px;
            width: 30px; height: 30px;
            border-radius: 50%;
            border: none;
            background: #f1f5f9;
            color: #64748b;
            cursor: pointer;
            font-size: 1rem;
        }

        .modal-header h3 { font-size: 1.2rem; color: #1e293b; margin: 15px 0 5px; font-weight: 700; }
        .modal-desc { color: #64748b; font-size: 0.9rem; margin-bottom: 20px; }

        .icon-circle {
            width: 60px; height: 60px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto; font-size: 1.8rem;
        }
        .icon-circle.ios { background: #eff6ff; color: #3b82f6; }
        .icon-circle.warning { background: #fff7ed; color: #f97316; }

        .ios-steps { text-align: left; display: flex; flex-direction: column; gap: 10px; }
        .ios-step {
            display: flex; align-items: center;
            background: #f8fafc; padding: 10px;
            border-radius: 12px; border: 1px solid #e2e8f0;
        }
        .step-num {
            background: #3b82f6; color: white;
            width: 20px; height: 20px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: bold; margin-right: 10px; flex-shrink: 0;
        }
        .step-text { flex: 1; font-size: 0.85rem; color: #334155; }
        .ios-icon-simulate { font-size: 1.2rem; color: #3b82f6; margin-left: 8px; }
        .ios-text-simulate { font-weight: bold; color: #3b82f6; font-size: 0.85rem; }

        .warning-box {
            background: #fef2f2; border: 1px solid #fecaca;
            border-radius: 12px; padding: 12px; margin-bottom: 15px;
        }
        .warning-box p { color: #b91c1c; font-size: 0.9rem; margin: 0; }

        .browser-suggestion p { font-size: 0.85rem; color: #64748b; margin-bottom: 8px; }
        .browser-badges { display: flex; justify-content: center; gap: 8px; }
        .badge {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 6px 12px; border-radius: 50px;
            font-size: 0.8rem; font-weight: 600;
        }
        .badge.chrome { background: #e0f2fe; color: #0284c7; }
        .badge.safari { background: #f0fdf4; color: #16a34a; }

        .zalo-guide-tip {
            margin-top: 15px; padding-top: 10px;
            border-top: 1px dashed #cbd5e1;
            font-size: 0.8rem; color: #475569; font-style: italic;
        }

        /* 3. Cảnh báo Footer Đẹp (Card UI) */
        .pwa-status-card {
            margin: 20px auto;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            max-width: 95%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            text-align: left;
            border-left: 4px solid #ddd;
            background: #fff;
        }
        .pwa-status-card.good { background: #f0fdf4; border-left-color: #27ae60; color: #166534; }
        .pwa-status-card.warning { background: #fffbeb; border-left-color: #f59e0b; color: #92400e; }
        .pwa-status-card.error { background: #fef2f2; border-left-color: #ef4444; color: #991b1b; }
        .pwa-icon-box { font-size: 1.2rem; }
        .pwa-text-content strong { display: block; margin-bottom: 2px; }

        /* Dark Mode */
        body.dark-mode .pwa-status-card { background: #1e293b; border-color: #334155; color: #cbd5e1; }
        body.dark-mode .pwa-status-card.good { background: #064e3b; border-color: #34d399; color: #d1fae5; }
        body.dark-mode .pwa-status-card.warning { background: #451a03; border-color: #fbbf24; color: #fef3c7; }
        body.dark-mode .pwa-status-card.error { background: #450a0a; border-color: #f87171; color: #fee2e2; }
        body.dark-mode .install-modal-card { background: #1e293b; }
        body.dark-mode .modal-header h3 { color: #f1f5f9; }
        body.dark-mode .modal-close-btn { background: #334155; }
        body.dark-mode .ios-step { background: #0f172a; border-color: #334155; }
        body.dark-mode .step-text { color: #cbd5e1; }

		/* === BẮT ĐẦU PHẦN ĐIỀU CHỈNH THỐNG KÊ CHO MOBILE === */
@media (max-width: 768px) {
    /* Chuyển sang dùng Grid để chia cột đều nhau */
    .dictionary-stats {
        display: grid !important; 
        grid-template-columns: repeat(2, 1fr); /* Chia thành 2 cột bằng nhau */
        gap: 10px; /* Giảm khoảng cách giữa các ô xuống 10px */
        margin: 1rem 0;
    }

    /* Điều chỉnh lại các ô thống kê */
    .stat-item {
        min-width: unset !important; /* Hủy bỏ chiều rộng tối thiểu 150px cũ */
        width: 100%; /* Chiếm hết chiều rộng cột */
        padding: 0.8rem 0.5rem; /* Thu nhỏ padding để tiết kiệm diện tích */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* Điều chỉnh cỡ chữ số cho cân đối */
    .stat-number {
        font-size: 1.4rem; /* Giảm kích thước số một chút */
        margin-bottom: 0.1rem;
    }

    /* Điều chỉnh cỡ chữ tiêu đề */
    .stat-label {
        font-size: 0.8rem; /* Giảm kích thước chữ mô tả */
        white-space: nowrap; /* Giữ chữ trên 1 dòng nếu có thể */
    }
}
/* === KẾT THÚC PHẦN ĐIỀU CHỈNH === */




		
	
</style>
</head>
<body>
    <div id="installGuideModal" class="install-modal" style="display:none;">
        <div class="install-modal-overlay" onclick="closeInstallModal()"></div>
        <div class="install-modal-card">
            <button class="modal-close-btn" onclick="closeInstallModal()"><i class="fas fa-times"></i></button>
            
            <div id="iosInstallGuide" class="modal-content-section" style="display:none;">
                <div class="modal-header">
                    <div class="icon-circle ios"><i class="fab fa-apple"></i></div>
                    <h3>Cài đặt trên iPhone/iPad</h3>
                </div>
                <p class="modal-desc">Thao tác đơn giản chỉ trong 3 bước:</p>
                <div class="ios-steps">
                    <div class="ios-step">
                        <span class="step-num">1</span>
                        <div class="step-text">Nhấn nút <strong>Chia sẻ (Share)</strong> trên thanh công cụ</div>
                        <i class="fas fa-share-square ios-icon-simulate"></i>
                    </div>
                    <div class="ios-step">
                        <span class="step-num">2</span>
                        <div class="step-text">Kéo lên và chọn dòng <br><strong>Thêm vào MH chính</strong></div>
                        <i class="fas fa-plus-square ios-icon-simulate"></i>
                    </div>
                    <div class="ios-step">
                        <span class="step-num">3</span>
                        <div class="step-text">Nhấn <strong>Thêm (Add)</strong> ở góc trên cùng bên phải</div>
                        <span class="ios-text-simulate">Thêm</span>
                    </div>
                </div>
            </div>

            <div id="inAppBrowserWarning" class="modal-content-section" style="display:none;">
                <div class="modal-header">
                    <div class="icon-circle warning"><i class="fas fa-exclamation-triangle"></i></div>
                    <h3 id="warningTitle">Trình duyệt hạn chế</h3>
                </div>
                
                <div class="warning-box">
                    <p id="warningText">Trình duyệt này không hỗ trợ cài đặt ứng dụng tốt nhất.</p>
                </div>

                <div class="browser-suggestion">
                    <p>Vui lòng mở bằng trình duyệt mặc định:</p>
                    <div class="browser-badges">
                        <span class="badge chrome"><i class="fab fa-chrome"></i> Google Chrome</span>
                        <span class="badge safari"><i class="fab fa-safari"></i> Safari</span>
                    </div>
                </div>
                
                <div class="zalo-guide-tip">
                    <i class="fas fa-hand-point-right"></i> Nhấn dấu <i class="fas fa-ellipsis-h"></i> ở góc màn hình & chọn <strong>"Mở bằng trình duyệt"</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Install App Button -->

<div id="installGuideModal" class="install-modal" style="display:none;">
        <div class="install-modal-overlay" onclick="closeInstallModal()"></div>
        <div class="install-modal-card">
            <button class="modal-close-btn" onclick="closeInstallModal()"><i class="fas fa-times"></i></button>
            
            <div id="iosInstallGuide" class="modal-content-section" style="display:none;">
                <div class="modal-header">
                    <div class="icon-circle ios"><i class="fab fa-apple"></i></div>
                    <h3>Cài đặt trên iPhone/iPad</h3>
                </div>
                <p class="modal-desc">Thao tác đơn giản chỉ trong 3 bước:</p>
                <div class="ios-steps">
                    <div class="ios-step">
                        <span class="step-num">1</span>
                        <div class="step-text">Nhấn nút <strong>Chia sẻ (Share)</strong> trên thanh công cụ</div>
                        <i class="fas fa-share-square ios-icon-simulate"></i>
                    </div>
                    <div class="ios-step">
                        <span class="step-num">2</span>
                        <div class="step-text">Kéo lên và chọn dòng <br><strong>Thêm vào MH chính</strong></div>
                        <i class="fas fa-plus-square ios-icon-simulate"></i>
                    </div>
                    <div class="ios-step">
                        <span class="step-num">3</span>
                        <div class="step-text">Nhấn <strong>Thêm (Add)</strong> ở góc trên cùng bên phải</div>
                        <span class="ios-text-simulate">Thêm</span>
                    </div>
                </div>
            </div>

            <div id="inAppBrowserWarning" class="modal-content-section" style="display:none;">
                <div class="modal-header">
                    <div class="icon-circle warning"><i class="fas fa-exclamation-triangle"></i></div>
                    <h3 id="warningTitle">Trình duyệt hạn chế</h3>
                </div>
                
                <div class="warning-box">
                    <p id="warningText">Trình duyệt này không hỗ trợ cài đặt ứng dụng tốt nhất.</p>
                </div>

                <div class="browser-suggestion">
                    <p>Vui lòng mở bằng trình duyệt mặc định:</p>
                    <div class="browser-badges">
                        <span class="badge chrome"><i class="fab fa-chrome"></i> Google Chrome</span>
                        <span class="badge safari"><i class="fab fa-safari"></i> Safari</span>
                    </div>
                </div>
                
                <div class="zalo-guide-tip">
                    <i class="fas fa-hand-point-right"></i> Nhấn dấu <i class="fas fa-ellipsis-h"></i> ở góc màn hình & chọn <strong>"Mở bằng trình duyệt"</strong>
                </div>
            </div>
        </div>
    </div>

    <button id="installButton" class="install-button" aria-label="Cài đặt ứng dụng">
        <i class="fas fa-download"></i> Cài App Ngay
    </button>


     <!-- Install App Button -->

	
    
    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi"></i> <span>Đang offline</span>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <div id="loadingText">Đang xử lý...</div>
    </div>

    <!-- Chat Widget -->
    <div class="chat-widget-container">
        <button class="chat-toggle-btn" id="chatToggleBtn" aria-label="Mở trợ lý chat">
            <i class="fas fa-comments"></i>
            <span class="notification-badge" id="chatNotification" style="display: none;">1</span>
        </button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h3><i class="fas fa-robot"></i> Trợ lý Xơ Đăng</h3>
                <button class="close-chat-btn" id="closeChatBtn" aria-label="Đóng chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <!-- Tin nhắn sẽ được tạo động -->
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Nhập câu hỏi của bạn..." aria-label="Nhập câu hỏi">
                <button class="send-btn" id="sendChatBtn" aria-label="Gửi tin nhắn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar - ĐÃ SỬA: XÓA MENU GIỚI THIỆU VÀ THÊM MENU Game học tập-->
    <nav class="navbar">
        <ul>
            <li><a href="#home" class="menu-link" onclick="showSection('home')"><i class="fas fa-home"></i> Trang chủ</a></li>
            <li><a href="#contribute" class="menu-link" onclick="showSection('contribute')"><i class="fas fa-microphone-alt"></i> Đóng góp từ vựng</a></li>
            <li><a href="#quiz" class="menu-link" onclick="showSection('quiz')"><i class="fas fa-book"></i> Học và kiểm tra</a></li>
            
	    <li><a href="https://tudienxedang.github.io/tudien/game.html" class="menu-link" target="_blank" rel="noopener noreferrer"><i class="fas fa-gamepad"></i> Game học tập</a></li>

            <li><button id="darkModeToggle" class="menu-button"><i class="fas fa-moon"></i> Dark Mode</button></li>
        </ul>
    </nav>

    <!-- Main Content Area -->
    <main>
        <!-- Trang chủ -->
        <section id="home" class="container active" 
         itemscope 
         itemtype="https://schema.org/WebApplication">
  <div itemprop="name" content="Hệ thống hỗ trợ học tiếng Xơ Đăng trên nền tảng PWA cho học sinh THCS" style="display:none;"></div>
  <div itemprop="description" content="Ứng dụng PWA học tiếng Xơ Đăng miễn phí với từ điển tương tác" style="display:none;"></div>
            <h1>Tra Cứu Tiếng Xơ Đăng - Tiếng Việt</h1>
            <div class="intro-content">
		<p> Hệ thống hỗ trợ học tiếng Xơ đăng (Xê đăng) trên nền tảng PWA cho học sinh THCS với <span id="dictionary-count">1000+ từ vựng chuẩn</span> và các mẫu câu ví dụ minh họa cụ thể, hỗ trợ phát âm và dịch thuật chính xác.</p>
                <div class="dictionary-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="stat-words">1000+</div>
                        <div class="stat-label">Từ vựng</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-audio">1000+</div>
                        <div class="stat-label">File âm thanh</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-examples">2000+</div>
                        <div class="stat-label">Ví dụ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stat-questions">100+</div>
                        <div class="stat-label">Câu hỏi ôn tập</div>
                    </div>
                </div>
                <div class="features-list">
                    <div class="feature-item">
                        <i class="fas fa-book"></i>
                        <span>Từ vựng chuẩn theo tài liệu dạy học tiếng Xơ Đăng</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-volume-up"></i>
                        <span>Hỗ trợ phát âm chuẩn</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-language"></i>
                        <span>Dịch thuật song ngữ hai chiều</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-comment-alt"></i>
                        <span>Ví dụ minh họa cho từng từ</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-microphone"></i>
                        <span>Hỗ trợ tìm kiếm bằng giọng nói</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-question-circle"></i>
                        <span>Trắc nghiệm đa dạng chủ đề</span>
                    </div>
		    <div class="feature-item">
                        <i class="fas fa-gamepad"></i>
                        <span>Trò chơi giải trí học tập</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-comments"></i>
                        <span>Trợ lý chat thông minh</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-wifi"></i>
                        <span>Hoạt động offline (PWA)</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Có thể cài đặt như ứng dụng</span>
                    </div>
                </div>
            </div>
            
            <form id="searchForm" role="search">
                <div class="input-group">
                    <label for="word" class="form-label">Nhập từ cần tra</label>
                    <div class="search-input-container">
                        <input type="text" id="word" placeholder="Ví dụ: ăn cơm, ka hme..." autocomplete="off" list="suggestions" aria-label="Nhập từ cần tra cứu">
                       <button type="button" id="speechButton" title="Nhấn để đọc từ" aria-label="Nhận diện giọng nói để tìm từ vựng">
                      <i class="fas fa-microphone"></i>
                     </button>
                    </div>
                    <datalist id="suggestions"></datalist>
                </div>
                <div class="input-group">
                    <label for="direction" class="form-label">Hướng dịch</label>
                    <select id="direction" aria-label="Chọn hướng dịch">
                        <option value="viet_to_ethnic">Tiếng Việt → Tiếng Xơ Đăng</option>
                        <option value="ethnic_to_viet">Tiếng Xơ Đăng → Tiếng Việt</option>
                    </select>
                </div>
                <button type="submit" class="search-button" aria-label="Tra cứu"><i class="fas fa-search"></i> Tra cứu</button>
            </form>
            
            <div class="search-status" id="searchStatus"></div>
            
            <div class="loading" id="loading" style="display:none">
                <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
            </div>
            
            <section aria-live="polite">
                <div class="result-container" id="resultContainer">
                    <div id="result">
                        <div class="no-result">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; color: #ccc; display: block;"></i>
                            <p>Nhập từ cần tra cứu và nhấn nút "Tra cứu"</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Hoặc sử dụng tính năng nhận diện giọng nói</p>
                        </div>
                    </div>
                    <div id="error" class="error" role="alert" hidden></div>
                </div>
            </section>
        </section>

        <!-- Trang Đóng góp -->
        <section id="contribute" class="container">
            <h1>Đóng Góp Từ Vựng</h1>
            
            <div class="intro-content" style="margin-bottom: 1.5rem;">
                <p style="text-align: justify;">Giúp chúng tôi xây dựng bộ từ điển Xơ Đăng hoàn thiện hơn bằng cách đóng góp từ vựng và file âm thanh. Bạn có thể chọn một trong hai chế độ đóng góp:</p>
                <div class="features-list">
                    <div class="feature-item">
                        <i class="fas fa-font"></i>
                        <span style="text-align: justify;"><strong>Từ đơn:</strong> Đóng góp từng từ kèm âm thanh</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-bullhorn"></i>
                        <span style="text-align: justify;"><strong>Thu hàng loạt:</strong> Thu âm nhiều từ cùng lúc</span>
                    </div>
                </div>
            </div>
            
            <div class="contribute-tabs">
                <button class="contribute-tab active" data-tab="single">Từ đơn</button>
                <button class="contribute-tab" data-tab="batch">Thu hàng loạt</button>
            </div>
            
            <!-- Tab Từ đơn -->
            <div id="singleTab" class="contribute-form">
                <div class="form-group">
                    <label for="vietnameseWord">Từ tiếng Việt</label>
                    <input type="text" id="vietnameseWord" class="form-input" placeholder="Ví dụ: Con mèo">
                </div>
                
                <div class="form-group">
                    <label for="xodangWord">Nghĩa tiếng Xơ Đăng</label>
                    <input type="text" id="xodangWord" class="form-input" placeholder="Ví dụ: Kon meo">
                </div>
                
                <div class="form-group">
                    <label>Âm thanh</label>
                    <div class="audio-controls">
                        <button id="recordAudioBtn" class="audio-btn record-btn">
                            <i class="fas fa-microphone"></i> Thu âm
                        </button>
                        <button id="uploadAudioBtn" class="audio-btn upload-btn">
                            <i class="fas fa-upload"></i> Tải lên
                        </button>
                        <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                    </div>
                    
                    <div class="audio-visualizer" id="audioVisualizer">
                        <div class="audio-wave" id="audioWave"></div>
                    </div>
                    
                    <div class="single-playback-controls" id="singlePlaybackControls" style="display: none;">
                        <button id="singlePlayAudioBtn" class="single-play-btn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button id="singleStopAudioBtn" class="single-stop-btn">
                            <i class="fas fa-stop"></i>
                        </button>
                        <button id="singleDeleteAudioBtn" class="single-delete-btn" title="Xóa file">
                            <i class="fas fa-trash"></i>
                        </button>
                        <span id="singleAudioFileName" style="margin-left: 10px; font-size: 0.9rem; color: #666;"></span>
                    </div>
                    
                    <div class="audio-status" id="audioStatus"></div>
                </div>
                
                <button id="submitSingleBtn" class="submit-contribute-btn">
                    <i class="fas fa-paper-plane"></i> Gửi từ vựng
                </button>
            </div>
            
            <!-- Tab Thu hàng loạt -->
            <div id="batchTab" class="contribute-form" style="display: none;">
                <div class="form-group">
                    <label>Thu âm hàng loạt</label>
                    <div class="audio-controls">
                        <button id="recordBatchBtn" class="audio-btn record-btn">
                            <i class="fas fa-microphone"></i> Bắt đầu thu
                        </button>
                        <button id="uploadBatchBtn" class="audio-btn upload-btn">
                            <i class="fas fa-upload"></i> Tải file lên
                        </button>
                        <input type="file" id="batchAudioInput" accept="audio/*" multiple style="display: none;">
                    </div>
                    
                    <div class="audio-visualizer" id="batchVisualizer">
                        <div class="audio-wave" id="batchWave"></div>
                    </div>
                    
                    <div class="audio-status" id="batchStatus">Chưa có file nào trong hàng đợi</div>
                    
                    <div class="queue-list" id="batchQueueList" style="display: none;">
                        <!-- Các file trong hàng đợi sẽ hiển thị ở đây -->
                    </div>
                </div>
                
                <button id="submitBatchBtn" class="submit-contribute-btn">
                    <i class="fas fa-paper-plane"></i> Gửi tất cả
                </button>
            </div>
        </section>

        <!-- Trang Học và kiểm tra (Gộp Ôn tập và Trắc nghiệm) -->
        <section id="quiz" class="container">
            <h1>Học và Kiểm Tra Tiếng Xơ Đăng</h1>
            
            <div class="intro-content">
                <p>Học từ vựng tiếng Xơ Đăng qua hệ thống flashcard thông minh, sau đó kiểm tra kiến thức bằng bài trắc nghiệm. Phương pháp học tập khoa học giúp bạn ghi nhớ lâu hơn.</p>
                <div class="study-progress-bar">
                    <div class="study-progress-fill" id="studyProgressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Bước 1: Chọn chủ đề -->
            <div id="studyQuizTopicSelection" class="study-quiz-topic-selection">
                <h2><i class="fas fa-folder-open"></i> Chọn Chủ Đề Học Tập</h2>
                <p>Chọn một chủ đề để bắt đầu học và kiểm tra kiến thức của bạn:</p>
                <div class="study-quiz-topics-grid" id="studyQuizTopicsGrid">
                    <!-- Các chủ đề sẽ được load từ API -->
                </div>
            </div>
            
            <!-- Bước 2: Giao diện học tập (Flashcard) -->
            <div id="studyInterface" class="study-interface" style="display: none;">
                <div class="study-header">
                    <div class="study-info">
                        <h2 id="currentStudyTopicTitle">Chủ đề: </h2>
                        <div class="study-progress">
                            <span id="currentStudyCardNumber">1</span>/<span id="totalStudyCards">0</span> thẻ
                        </div>
                    </div>
                    
                    <div class="study-stats">
                        <i class="fas fa-chart-line"></i> <span id="studyCompletion">0% đã học</span>
                    </div>
                </div>
                
                <!-- Hướng dẫn học tập mới -->
                <div class="study-guide">
                    <h3><i class="fas fa-graduation-cap"></i> Hướng Dẫn Học Tập</h3>
                    <div class="guide-steps">
                        <div class="guide-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Xem câu hỏi</h4>
                                <p>Đọc câu hỏi trên mặt trước của thẻ. Cố gắng nhớ câu trả lời trước khi lật thẻ.</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Lật thẻ</h4>
                                <p>Nhấn vào thẻ hoặc nút "Lật thẻ" để xem đáp án. Khi bạn lật thẻ, dấu tick xanh sẽ xuất hiện để đánh dấu bạn đã học thẻ này.</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Ôn tập</h4>
                                <p>Sử dụng nút "Câu trước" và "Câu tiếp theo" để xem lại các thẻ đã học hoặc chuyển sang thẻ mới.</p>
                            </div>
                        </div>
                        <div class="guide-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Kiểm tra</h4>
                                <p>Sau khi học ít nhất 70% số thẻ, nút "Bắt đầu kiểm tra" sẽ mở khóa. Nhấn vào để làm bài trắc nghiệm.</p>
                            </div>
                        </div>
                    </div>
                    <div class="study-tip">
                        <p><i class="fas fa-lightbulb"></i> Mẹo: Học ít nhất 70% số thẻ để đảm bảo bạn đã nắm vững kiến thức trước khi làm bài kiểm tra!</p>
                    </div>
                </div>
                
                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard">
                        <!-- Hiệu ứng hoàn thành -->
                        <div class="card-completion-effect" id="cardCompletionEffect"></div>
                        
                        <!-- Mặt trước -->
                        <div class="flashcard-front" id="flashcardFront">
                            <div class="flashcard-number" id="frontCardNumber">1/10</div>
                            <div class="flashcard-tick" id="frontTick"><i class="fas fa-check"></i></div>
                            <div class="flashcard-question" id="flashcardQuestion">
                                <!-- Câu hỏi sẽ được hiển thị ở đây -->
                            </div>
                            <div class="flashcard-instruction">
                                <i class="fas fa-hand-point-up"></i> Nhấn vào thẻ để xem đáp án
                            </div>
                        </div>
                        
                        <!-- Mặt sau -->
                        <div class="flashcard-back" id="flashcardBack">
                            <div class="flashcard-number" id="backCardNumber">1/10</div>
                            <div class="flashcard-tick" id="backTick"><i class="fas fa-check"></i></div>
                            <!-- THÊM NỘI DUNG CÂU HỎI KHI LẬT THẺ -->
                            <div class="flashcard-question-full" id="flashcardQuestionFull">
                                <!-- Câu hỏi đầy đủ sẽ được hiển thị ở đây -->
                            </div>
                            <div class="flashcard-answer" id="flashcardAnswer">
                                <!-- Đáp án sẽ được hiển thị ở đây -->
                            </div>
                            <div class="flashcard-instruction">
                                <i class="fas fa-hand-point-up"></i> Nhấn vào thẻ để quay lại
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flashcard-controls">
                    <button id="prevCardBtn" class="flashcard-nav-btn" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="flipCardBtn" class="flashcard-flip-btn">
                        <i class="fas fa-sync-alt"></i> Lật thẻ
                    </button>
                    <button id="nextCardBtn" class="flashcard-nav-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="study-progress-bar">
                    <div class="study-progress-fill" id="studySessionProgressFill" style="width: 0%"></div>
                </div>
                
                <button id="startQuizBtn" class="start-quiz-btn" disabled>
                    <i class="fas fa-play-circle"></i> Bắt đầu kiểm tra
                </button>
            </div>
            
            <!-- Bước 3: Giao diện làm bài trắc nghiệm -->
            <div id="quizInterface" class="quiz-interface" style="display: none;">
                <div class="quiz-header">
                    <div class="quiz-info">
                        <h2 id="currentQuizTopicTitle">Chủ đề: </h2>
                        <div class="quiz-progress">
                            <span id="currentQuestionNumber">1</span>/5
                        </div>
                    </div>
                    
                    <div class="quiz-timer">
                        <i class="fas fa-clock"></i> Thời gian: <span id="quizTimer">00:00</span>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question-text" id="questionText">
                        <!-- Câu hỏi sẽ được hiển thị ở đây -->
                    </div>
                    
                    <div class="options-container" id="optionsContainer">
                        <!-- Các lựa chọn sẽ được hiển thị ở đây -->
                    </div>
                </div>
                
                <div class="quiz-controls">
                    <button id="prevQuestionBtn" class="quiz-control-btn">
                        <i class="fas fa-arrow-left"></i> Câu trước
                    </button>
                    <button id="nextQuestionBtn" class="quiz-control-btn">
                        Câu tiếp theo <i class="fas fa-arrow-right"></i>
                    </button>
                    <button id="submitQuizBtn" class="quiz-control-btn submit-btn">
                        <i class="fas fa-paper-plane"></i> Nộp bài
                    </button>
                </div>
            </div>
            
            <!-- Bước 4: Kết quả -->
            <div id="quizResult" class="quiz-result" style="display: none;">
                <div class="result-header">
                    <h2><i class="fas fa-trophy"></i> Kết Quả Kiểm Tra</h2>
                    <p id="resultTopic">Chủ đề: </p>
                </div>
                
                <div class="score-container">
                    <div class="score-circle">
                        <span id="finalScore">0</span>
                        <small>/5</small>
                    </div>
                    <div class="score-text">
                        <h3 id="resultTitle">Kết quả</h3>
                        <p id="resultDescription"></p>
                    </div>
                </div>
                
                <div class="result-details">
                    <h3><i class="fas fa-chart-bar"></i> Chi tiết</h3>
                    <div class="details-grid" id="resultDetails">
                        <!-- Chi tiết từng câu hỏi -->
                    </div>
                </div>
                
                <div class="result-actions">
                    <button id="retryQuizBtn" class="result-action-btn">
                        <i class="fas fa-redo"></i> Làm lại
                    </button>
                    <button id="newTopicBtn" class="result-action-btn">
                        <i class="fas fa-folder-plus"></i> Chủ đề mới
                    </button>
                    <button id="shareResultBtn" class="result-action-btn">
                        <i class="fas fa-share"></i> Chia sẻ
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>© 2025@ Hệ thống hỗ trợ học tiếng Xơ Đăng trên nền tảng PWA cho học sinh THCS</p>
            <p>Tác giả: Minh Bảo - Hà Mi, Trường THCS Chu Văn An xã Đăk Hà tỉnh Quảng Ngãi</p>
            <div class="hashtag-container">
                <a href="#TừĐiểnXơĐăng" class="hashtag">#TừĐiểnXơĐăng</a>
                <a href="#NgônNgữHọc" class="hashtag">#TừĐiểnXêĐăng</a>
                <a href="#TiếngDânTộc" class="hashtag">#TiếngDânTộc</a>
                <a href="#HọcTiếngXơĐăng" class="hashtag">#HọcTiếngXơĐăng</a>
                <a href="#VănHóaDânTộc" class="hashtag">#VănHóaDânTộc</a>
                <a href="#NgônNgữHọc" class="hashtag">#NgônNgữHọc</a>
                <a href="#PWA" class="hashtag">#ỨngDụngOffline</a>
                <a href="#HọcTập" class="hashtag">#HọcTậpThôngMinh</a>
                <a href="#GiảiTrí" class="hashtag">#GiảiTríHọcTập</a>
            </div>
            <div class="contact-section">
                <span class="contact-title">Liên hệ</span>
                <div class="social-icons">
                    <a href="https://zalo.me/0877623579" target="_blank" title="Zalo" aria-label="Liên hệ qua Zalo">
    <i class="fas fa-comment-dots"></i>
</a>
                    <a href="https://facebook.com/your_facebook_page" target="_blank" title="Facebook" aria-label="Trang Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="baotruongminh201@gmail.com" title="Gmail" aria-label="Gửi email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript với PWA Integration -->
    <script>
        // ===== HÀM CHUNG =====
        function showSection(sectionId) {
            document.querySelectorAll('.container').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.menu-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${sectionId}`) {
                    link.classList.add('active');
                }
            });
        }

        // Khởi tạo hiển thị trang chủ
        showSection('home');

        // Sự kiện cho menu
        document.querySelectorAll('.menu-link').forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const sectionId = this.getAttribute('href').substring(1);
                showSection(sectionId);
            });
        });

        // Dark Mode
        document.getElementById('darkModeToggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.className = 'fas fa-sun';
                localStorage.setItem('darkMode', 'true');
            } else {
                icon.className = 'fas fa-moon';
                localStorage.setItem('darkMode', 'false');
            }
        });

        // Kiểm tra dark mode từ localStorage
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeToggle').querySelector('i').className = 'fas fa-sun';
        }

        // ===== PWA INSTALLATION =====

        
        // ===== PWA LOGIC TOÀN DIỆN (Nút Cài Đặt + Cảnh Báo Thông Minh) =====

        // 1. Hàm kiểm tra trình duyệt & Hệ điều hành chi tiết
        function checkEnvironment() {
            const ua = navigator.userAgent || navigator.vendor || window.opera;
            return {
                // Phát hiện iOS (iPhone/iPad)
                isIOS: /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1),
                
                // Phát hiện Android
                isAndroid: /android/i.test(ua),
                
                // Phát hiện App chặn (Zalo, Facebook, Instagram...)
                isInApp: /Zalo|FBAN|FBAV|Instagram|Line|Kakaotalk|Twitter/i.test(ua),
                
                // Phát hiện trình duyệt của hãng (Samsung, Xiaomi, Oppo...)
                isOEM: /SamsungBrowser|MiuiBrowser|HeyTapBrowser|OppoBrowser|VivoBrowser|UCBrowser/i.test(ua),

                // Kiểm tra đã cài đặt chưa
                isStandalone: window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true
            };
        }

        const env = checkEnvironment();
        let deferredPrompt = null; 

        // Bắt sự kiện cài đặt của Chrome
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e; 
            console.log("Đã bắt được sự kiện cài đặt.");
        });

        // CHẠY KHI TRANG TẢI XONG
        window.addEventListener('load', () => {
            const installBtn = document.getElementById('installButton');
            const footerContent = document.querySelector('.footer-content');

            // 1. Xử lý hiển thị nút Cài đặt
            // Nếu chưa cài đặt -> LUÔN HIỆN NÚT (Nhờ CSS opacity: 1)
            // Nếu đã cài rồi -> Ẩn nút đi
            if (installBtn && env.isStandalone) {
                installBtn.style.display = 'none';
            }

            // 2. Tạo thẻ Cảnh báo đẹp ở Footer (Chỉ hiện khi chưa cài app)
            if (!env.isStandalone) { 
                const statusCard = document.createElement('div');
                let cardClass = 'good';
                let icon = '<i class="fas fa-mobile-alt"></i>';
                let title = 'Sẵn sàng cài đặt';
                let desc = 'Nhấn nút "Cài App Ngay" ở góc trái để sử dụng Offline.';

                // Logic hiển thị nội dung cảnh báo theo môi trường
                if (env.isInApp) {
                    cardClass = 'error';
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    title = 'Trình duyệt hạn chế';
                    desc = 'Bạn đang dùng Zalo/Facebook. Vui lòng mở bằng Chrome hoặc Safari để cài đặt.';
                } 
                else if (env.isOEM) {
                    cardClass = 'warning';
                    icon = '<i class="fas fa-info-circle"></i>';
                    title = 'Khuyên dùng Chrome';
                    desc = 'Trình duyệt này (Samsung/Xiaomi) có thể không hỗ trợ tốt nhất. Hãy dùng Google Chrome.';
                }
                else if (env.isIOS) {
                    cardClass = 'warning'; // iOS màu vàng nhẹ
                    icon = '<i class="fab fa-apple"></i>';
                    title = 'Dành cho iPhone/iPad';
                    desc = 'Sử dụng Safari và làm theo hướng dẫn để cài đặt.';
                }

                // Render HTML thẻ cảnh báo
                statusCard.className = `pwa-status-card ${cardClass}`;
                statusCard.innerHTML = `
                    <div class="pwa-icon-box">${icon}</div>
                    <div class="pwa-text-content">
                        <strong>${title}</strong>
                        <span>${desc}</span>
                    </div>
                `;
                
                // Chèn vào cuối footer
                if(footerContent) footerContent.appendChild(statusCard);
            }
        });

        // XỬ LÝ KHI NHẤN NÚT CÀI ĐẶT
        const installBtnElement = document.getElementById('installButton');
        if (installBtnElement) {
            installBtnElement.addEventListener('click', () => {
                const modal = document.getElementById('installGuideModal');
                const iosGuide = document.getElementById('iosInstallGuide');
                const warningSection = document.getElementById('inAppBrowserWarning');
                const warningTitle = document.getElementById('warningTitle');
                const warningText = document.getElementById('warningText');

                // Reset hiển thị (Ẩn hết các phần con trước khi hiện cái cần thiết)
                iosGuide.style.display = 'none';
                warningSection.style.display = 'none';

                // Trường hợp 1: Zalo/Facebook hoặc Trình duyệt máy (Samsung/Xiaomi)
                if (env.isInApp || env.isOEM) {
                    warningSection.style.display = 'block';
                    
                    if (env.isOEM) {
                        // Cảnh báo nhẹ cho Samsung/Xiaomi
                        warningTitle.innerHTML = '<i class="fas fa-info-circle"></i> Lưu ý nhỏ';
                        warningText.textContent = 'Bạn đang dùng trình duyệt mặc định của máy. Nếu nút cài đặt không hoạt động, hãy thử mở trang web này bằng Google Chrome.';
                    } else {
                        // Cảnh báo đỏ cho Zalo
                        warningTitle.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Trình duyệt không hỗ trợ';
                        warningText.textContent = 'Trình duyệt Zalo/Facebook chặn tính năng này. Vui lòng nhấn dấu 3 chấm góc màn hình -> Chọn "Mở bằng trình duyệt".';
                    }
                    
                    modal.style.display = 'flex';
                    return;
                }

                // Trường hợp 2: iOS (Safari)
                if (env.isIOS) {
                    iosGuide.style.display = 'block';
                    modal.style.display = 'flex';
                    return;
                }

                // Trường hợp 3: Android/PC (Chrome chuẩn)
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted setup');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    // Lỗi không xác định hoặc đã cài rồi, hoặc trình duyệt PC không hỗ trợ
                    // Vẫn hiện thông báo để người dùng biết
                    showToast('Không thể tự động cài đặt. Hãy kiểm tra menu trình duyệt > Cài đặt ứng dụng.', 'info');
                }
            });
        }

        // Đóng Modal
        window.closeInstallModal = function() {
            const modal = document.getElementById('installGuideModal');
            if(modal) modal.style.display = 'none';
        }
        
        // Đóng modal khi click ra ngoài vùng trắng
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('installGuideModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });

        // Sự kiện khi cài đặt thành công -> Ẩn nút đi
        window.addEventListener('appinstalled', () => {
            if(installBtnElement) installBtnElement.style.display = 'none';
            // Ẩn luôn thẻ cảnh báo ở footer nếu có
            const statusCard = document.querySelector('.pwa-status-card');
            if(statusCard) statusCard.style.display = 'none';
            
            showToast('Cài đặt thành công! Kiểm tra màn hình chính.', 'success');
        });
        
     

		

        window.addEventListener('offline', () => {
            offlineIndicator.querySelector('i').className = 'fas fa-wifi-slash';
            offlineIndicator.querySelector('span').textContent = 'Đang offline';
            offlineIndicator.classList.remove('online');
            offlineIndicator.classList.add('show');
        });

        // Kiểm tra trạng thái mạng ban đầu
        if (!navigator.onLine) {
            offlineIndicator.classList.add('show');
        }

        // ===== SERVICE WORKER REGISTRATION =====
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                        
                        // Kiểm tra cập nhật
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showToast('Có phiên bản mới! Làm mới trang để cập nhật.', 'info');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });

            // Kiểm tra trạng thái background sync
            navigator.serviceWorker.ready.then(registration => {
                if ('sync' in registration) {
                    console.log('Background Sync được hỗ trợ');
                }
            });
        }

        // ===== TỪ ĐIỂN CHÍNH - ĐÃ SỬA LỖI HIỂN THỊ THÊM =====
        (function() {
            // --- CẤU HÌNH ---
            const config = {
                API_KEY: 'AIzaSyD757jS4SLR7-EzrPgrW9WrLQeD2DQExHw',
                SHEET_ID: '1Z59pDBu_tGwlYqUeS1-VJLpcHozp7LbxnC_-qhT3iHs',
                RANGE: 'Sheet1!A2:F'
            };
            
            // --- BIẾN TOÀN CỤC ---
            let dictionary = [];
            let initialized = false;
            let currentSearchResults = [];
            let currentDisplayedResults = 0;
            let isProcessingMoreResults = false;
            const MAX_INITIAL_RESULTS = 5; // Chỉ hiển thị tối đa 5 từ ban đầu
            
            const dom = {
                searchForm: document.getElementById('searchForm'),
                wordInput: document.getElementById('word'),
                directionSelect: document.getElementById('direction'),
                resultDiv: document.getElementById('result'),
                errorDiv: document.getElementById('error'),
                loading: document.getElementById('loading'),
                suggestions: document.getElementById('suggestions'),
                speechButton: document.getElementById('speechButton'),
                dictionaryCount: document.getElementById('dictionary-count'),
                statWords: document.getElementById('stat-words'),
                statAudio: document.getElementById('stat-audio'),
                statExamples: document.getElementById('stat-examples'),
                statQuestions: document.getElementById('stat-questions'),
                searchStatus: document.getElementById('searchStatus')
            };

            // --- TIỆN ÍCH ---
            function showLoading() { 
                dom.loading.style.display = 'block'; 
            }
            
            function hideLoading() { 
                dom.loading.style.display = 'none'; 
            }
            
            function showError(message) { 
                dom.errorDiv.textContent = message; 
                dom.errorDiv.hidden = false; 
                dom.resultDiv.innerHTML = '';
            }
            
            function clearResults() { 
                dom.resultDiv.innerHTML = ''; 
                dom.errorDiv.hidden = true; 
                dom.searchStatus.textContent = '';
                currentDisplayedResults = 0;
                isProcessingMoreResults = false;
            }

            function showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                toastContainer.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // --- TẢI DỮ LIỆU ---
            async function fetchDictionary() {
                try {
                    showLoading();
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.SHEET_ID}/values/${config.RANGE}?key=${config.API_KEY}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`Lỗi mạng: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data.values) {
                        throw new Error('Dữ liệu không hợp lệ. Kiểm tra cấu trúc bảng tính.');
                    }
                    
                    // Parse dữ liệu
                    dictionary = data.values.map(row => ({
                        viet: row[0]?.trim() || '',
                        ethnic: row[1]?.trim() || '',
                        pronunciation: row[2]?.trim() || '',
                        driveId: row[3]?.trim() || '',
                        exampleViet: row[4]?.trim() || '',
                        exampleEthnic: row[5]?.trim() || ''
                    })).filter(item => item.viet && item.ethnic);
                    
                    initialized = true;
                    
                    // Cập nhật thống kê
                    dom.dictionaryCount.textContent = `${dictionary.length}+ từ vựng chuẩn`;
                    dom.statWords.textContent = `${dictionary.length}+`;
                    
                    const audioCount = dictionary.filter(item => item.driveId && item.driveId.trim() !== '' && item.driveId !== 'null').length;
                    dom.statAudio.textContent = `${audioCount}+`;
                    
                    const exampleCount = dictionary.filter(item => (item.exampleViet || item.exampleEthnic) && item.exampleViet !== 'null' && item.exampleEthnic !== 'null').length;
                    dom.statExamples.textContent = `${exampleCount}+`;
                    
                    // Khởi tạo autocomplete
                    initAutocomplete();
                    
                    showToast('Dữ liệu đã được tải thành công', 'success');
                    
                } catch (error) {
                    console.error('Lỗi khi tải dictionary:', error);
                    showError(`Lỗi tải dữ liệu: ${error.message}`);
                    showToast('Không thể tải dữ liệu. Vui lòng thử lại sau.', 'error');
                } finally {
                    hideLoading();
                }
            }

            // --- TÌM KIẾM THÔNG MINH ---
            function smartSearch(term, direction) {
                const rawKeyword = term.toLowerCase().trim();
                const isVietToEthnic = direction === 'viet_to_ethnic';
                
                if (!rawKeyword || rawKeyword.length === 0) {
                    return [];
                }
                
                // Tạo regex để tìm từ chính xác
                const safeKeyword = rawKeyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const strictRegex = new RegExp(`(^|[^a-zA-Z0-9À-ỹ])${safeKeyword}([^a-zA-Z0-9À-ỹ]|$)`, 'i');
                
                // Tìm từ chính xác
                let exactMatches = [];
                
                if (isVietToEthnic) {
                    exactMatches = dictionary.filter(item => {
                        return item.viet && strictRegex.test(item.viet);
                    });
                } else {
                    exactMatches = dictionary.filter(item => {
                        return item.ethnic && strictRegex.test(item.ethnic);
                    });
                }
                
                // Chỉ trả về từ chính xác
                const finalResults = exactMatches.map(item => ({
                    ...item,
                    matchType: 'exact',
                    score: 20
                }));
                
                // Loại bỏ trùng lặp
                const uniqueMap = new Map();
                finalResults.forEach(item => {
                    const key = `${item.viet}|${item.ethnic}`;
                    if (!uniqueMap.has(key) || item.score > uniqueMap.get(key).score) {
                        uniqueMap.set(key, item);
                    }
                });
                
                // Chuyển map thành mảng và sắp xếp
                let displayList = Array.from(uniqueMap.values());
                
                // Sắp xếp
                displayList.sort((a, b) => {
                    const wordA = isVietToEthnic ? a.viet : a.ethnic;
                    const wordB = isVietToEthnic ? b.viet : b.ethnic;
                    
                    if (wordA.toLowerCase() === rawKeyword && wordB.toLowerCase() !== rawKeyword) return -1;
                    if (wordB.toLowerCase() === rawKeyword && wordA.toLowerCase() !== rawKeyword) return 1;
                    
                    return wordA.length - wordB.length;
                });
                
                return displayList.slice(0, 50);
            }

            // --- RENDER KẾT QUẢ - ĐÃ SỬA THỨ TỰ HIỂN THỊ ====
            function renderCard(entry, direction) {
                const isVietToEthnic = direction === 'viet_to_ethnic';
                
                const sourceWord = isVietToEthnic ? entry.viet : entry.ethnic;
                const targetWord = isVietToEthnic ? entry.ethnic : entry.viet;
                const sourceLabel = isVietToEthnic ? 'Tiếng Việt' : 'Tiếng Xơ Đăng';
                const targetLabel = isVietToEthnic ? 'Tiếng Xơ Đăng' : 'Tiếng Việt';
                
                const pronunciation = entry.pronunciation;
                const driveId = entry.driveId;
                const exampleViet = entry.exampleViet;
                const exampleEthnic = entry.exampleEthnic;
                const matchType = entry.matchType || 'exact';
                
                // Tạo class dựa trên loại match
                const cardClass = 'word-card exact-match';
                const matchTypeLabel = '<span class="match-type exact-match-type">Từ chính xác</span>';
                
                // Audio player với Google Drive iframe - ĐÃ ẨN ICON ÂM THANH
                let audioPlayer = '';
                if (driveId && driveId.trim() !== '' && driveId !== 'null' && driveId !== 'undefined') {
                    const audioUrl = `https://drive.google.com/file/d/${driveId}/preview`;
                    
                    audioPlayer = `
                        <div class="audio-player-container">
                            <div class="audio-player-title">
                                <i class="fas fa-volume-up" style="display: none !important;"></i> Phát âm:
                            </div>
                            <div class="drive-player-wrapper">
                                <iframe 
                                    class="drive-audio-player"
                                    src="${audioUrl}" 
                                    frameborder="0" 
                                    allow="autoplay; encrypted-media" 
                                    allowfullscreen
                                    title="Phát âm tiếng Xơ Đăng"
                                    loading="lazy">
                                </iframe>
                            </div>
                            <div class="audio-info">Phát âm chuẩn từ tài liệu dạy học tiếng Xơ Đăng</div>
                        </div>
                    `;
                }

                // Ví dụ minh họa
                let exampleSection = '';
                if (exampleViet || exampleEthnic) {
                    exampleSection = `
                        <div class="example-section">
                            <div class="example-title">
                                <i class="fas fa-comment-alt"></i> Ví dụ minh họa:
                            </div>
                            <div class="example-content">
                                ${exampleViet ? `
                                    <div class="example-viet">
                                        <span class="example-label">Tiếng Việt:</span> 
                                        <span class="word-text">${exampleViet}</span>
                                    </div>
                                ` : ''}
                                ${exampleEthnic ? `
                                    <div class="example-ethnic">
                                        <span class="example-label">Tiếng Xơ Đăng:</span> 
                                        <span class="word-text">${exampleEthnic}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }

                // FIX: THAY ĐỔI THỨ TỰ HIỂN THỊ - Tiếng Việt -> Tiếng Xơ Đăng -> Phiên âm -> Phát âm
                return `
                    <div class="${cardClass}">
                        <div class="word-display">
                            <div class="word-display-item">
                                <div class="word-display-label">
                                    <i class="fas fa-language"></i> ${sourceLabel}:
                                    ${matchTypeLabel}
                                </div>
                                <div class="word-display-value">
                                    <span class="highlight-word">${sourceWord}</span>
                                </div>
                            </div>
                            
                            <div class="word-display-item">
                                <div class="word-display-label">
                                    <i class="fas fa-flag"></i> ${targetLabel}:
                                </div>
                                <div class="word-display-value">
                                    <span class="word-text">${targetWord}</span>
                                </div>
                            </div>
                            
                            ${pronunciation ? `
                                <div class="word-display-item">
                                    <div class="word-display-label">
                                        <i class="fas fa-volume-up"></i> Phiên âm (Xơ Đăng):
                                    </div>
                                    <div class="word-display-value">
                                        <span class="pronunciation">${pronunciation}</span>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${audioPlayer}
                        ${exampleSection}
                    </div>
                `;
            }

            // --- HIỂN THỊ KẾT QUẢ BAN ĐẦU ---
            function renderInitialResults(results, direction) {
                if (results.length === 0) {
                    return `
                        <div class="no-result">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; color: #ccc; display: block;"></i>
                            <p>Không tìm thấy kết quả phù hợp</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Thử tìm kiếm với từ khóa khác hoặc kiểm tra chính tả</p>
                        </div>
                    `;
                }
                
                // Chỉ hiển thị tối đa 5 kết quả - KHÔNG CÓ NÚT "HIỂN THỊ THÊM"
                const displayResults = results.slice(0, MAX_INITIAL_RESULTS);
                let html = displayResults.map(entry => renderCard(entry, direction)).join('');
                currentDisplayedResults = displayResults.length;
                
                // THÔNG BÁO SỐ LƯỢNG KẾT QUẢ
                if (results.length > MAX_INITIAL_RESULTS) {
                    html += `
                        <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px dashed #ddd;">
                            <p style="font-size: 0.9rem; color: #666;">
                                Hiển thị ${MAX_INITIAL_RESULTS}/${results.length} kết quả. Để xem kết quả chính xác hơn, hãy nhập từ khóa cụ thể hơn.
                            </p>
                        </div>
                    `;
                }
                
                return html;
            }

            // --- XỬ LÝ TÌM KIẾM ---
            function handleSearch(e) {
                if (e) e.preventDefault();
                
                if (!initialized) {
                    showError('Dữ liệu chưa sẵn sàng. Vui lòng thử lại sau.');
                    return;
                }
                
                const term = dom.wordInput.value.trim();
                const direction = dom.directionSelect.value;
                
                if (!term) {
                    showError('Vui lòng nhập từ cần tra');
                    return;
                }
                
                clearResults();
                dom.searchStatus.textContent = `Đang tìm kiếm "${term}"...`;
                
                // Sử dụng tìm kiếm thông minh
                currentSearchResults = smartSearch(term, direction);
                currentDisplayedResults = 0;
                
                // FIX: Chỉ hiển thị tối đa 5 kết quả trong thông báo
                const displayCount = currentSearchResults.length > MAX_INITIAL_RESULTS ? MAX_INITIAL_RESULTS : currentSearchResults.length;
                
                // Cập nhật trạng thái tìm kiếm
                if (currentSearchResults.length > 0) {
                    dom.searchStatus.textContent = `Tìm thấy ${displayCount} kết quả cho "${term}"`;
                } else {
                    dom.searchStatus.textContent = `Không tìm thấy kết quả cho "${term}"`;
                }
                
                // Hiển thị kết quả ban đầu
                dom.resultDiv.innerHTML = renderInitialResults(currentSearchResults, direction);
                
                // Cuộn đến kết quả
                dom.resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // --- AUTOCOMPLETE ---
            function initAutocomplete() {
                dom.wordInput.addEventListener('input', function() {
                    const term = this.value.toLowerCase().trim();
                    dom.suggestions.innerHTML = '';
                    
                    if (term.length < 1) return;
                    
                    const direction = dom.directionSelect.value;
                    const isVietToEthnic = direction === 'viet_to_ethnic';
                    
                    // Lấy các từ gợi ý
                    const suggestions = dictionary
                        .filter(item => {
                            const wordToCheck = isVietToEthnic ? item.viet : item.ethnic;
                            return wordToCheck && wordToCheck.toLowerCase().includes(term);
                        })
						 // Gợi ý số từ tìm kiếm
                        .slice(0, 5);
                    
                    suggestions.forEach(item => {
                        const option = document.createElement('option');
                        option.value = isVietToEthnic ? item.viet : item.ethnic;
                        dom.suggestions.appendChild(option);
                    });
                });
            }

            // --- NHẬN DIỆN GIỌNG NÓI ---
            function initSpeechRecognition() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    dom.speechButton.disabled = true;
                    dom.speechButton.title = 'Trình duyệt không hỗ trợ nhận diện giọng nói';
                    return;
                }

                const recognition = new SpeechRecognition();
                recognition.lang = 'vi-VN';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                recognition.continuous = false;

                // FIX: Thêm hiệu ứng âm thanh khi nhấn nút micro
                function playSound() {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                    } catch (e) {
                        console.log("Không thể phát âm thanh: ", e);
                    }
                }

                dom.speechButton.addEventListener('click', () => {
                    if (dom.speechButton.classList.contains('listening')) {
                        recognition.stop();
                        dom.speechButton.classList.remove('listening');
                        dom.speechButton.innerHTML = '<i class="fas fa-microphone"></i>';
                        dom.searchStatus.textContent = '';
                        return;
                    }

                    // Phát âm thanh khi bắt đầu thu
                    playSound();
                    
                    dom.speechButton.classList.add('listening');
                    recognition.start();

                    recognition.onstart = () => {
                        dom.speechButton.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                        dom.searchStatus.textContent = 'Đang lắng nghe... Nói từ cần tra cứu.';
                    };

                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript.replace(/\.$/, '').trim();
                        dom.wordInput.value = transcript;
                        
                        if (transcript) {
                            handleSearch();
                        }
                    };

                    recognition.onend = () => {
                        dom.speechButton.classList.remove('listening');
                        dom.speechButton.innerHTML = '<i class="fas fa-microphone"></i>';
                    };

                    recognition.onerror = (event) => {
                        console.error('Lỗi nhận diện giọng nói:', event.error);
                        dom.speechButton.classList.remove('listening');
                        dom.speechButton.innerHTML = '<i class="fas fa-microphone"></i>';
                        
                        if (event.error === 'not-allowed') {
                            dom.searchStatus.textContent = 'Cần cấp quyền sử dụng microphone để nhận diện giọng nói.';
                            showToast('Cần cấp quyền sử dụng microphone', 'error');
                        } else {
                            dom.searchStatus.textContent = `Lỗi nhận diện giọng nói: ${event.error}`;
                            showToast(`Lỗi nhận diện giọng nói: ${event.error}`, 'error');
                        }
                    };
                });
            }

            // --- ĐĂNG KÝ SỰ KIỆN ---
            dom.searchForm.addEventListener('submit', handleSearch);
            
            dom.directionSelect.addEventListener('change', () => {
                dom.wordInput.value = '';
                clearResults();
                dom.searchStatus.textContent = 'Đã thay đổi hướng dịch. Nhập từ mới để tra cứu.';
                dom.resultDiv.innerHTML = `
                    <div class="no-result">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; color: #ccc; display: block;"></i>
                        <p>Nhập từ cần tra cứu và nhấn nút "Tra cứu"</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Hoặc sử dụng tính năng nhận diện giọng nói</p>
                    </div>
                `;
            });
            
            // Khởi động ứng dụng
            fetchDictionary().then(() => {
                initSpeechRecognition();
                showToast('Hệ thống tìm kiếm thông minh đã sẵn sàng', 'success');
            }).catch(error => {
                console.error('Lỗi khởi động ứng dụng:', error);
                showError('Không thể khởi động ứng dụng. Vui lòng thử lại sau.');
            });
            
        })();

        // ===== PHẦN ĐÓNG GÓP - ĐÃ SỬA THÔNG TIN HIỂN THỊ ÂM THANH =====
        (function() {
            // ===== CONFIGURATION =====
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9XYdorp6vsKFTCrqx2tUSJGecpOmCbrROqKfkHYSFn2WXieQtJXWCQvSJvxCk6yrs/exec';
            
            // ===== GLOBAL STATE =====
            let currentTab = 'single';
            let mediaRecorder = null;
            let audioChunks = [];
            let audioBlob = null;
            let animationId = null;
            let batchQueue = [];
            let isRecording = false;
            let isPlaying = false;
            let currentAudio = null;
            let batchAudio = null;
            let isBatchPlaying = false;
            let currentBatchPlayingIndex = -1;
            let batchAnimationId = null;
            
            // ===== DOM ELEMENTS =====
            const dom = {
                tabSingle: document.querySelector('[data-tab="single"]'),
                tabBatch: document.querySelector('[data-tab="batch"]'),
                singleTab: document.getElementById('singleTab'),
                batchTab: document.getElementById('batchTab'),
                vietnameseWord: document.getElementById('vietnameseWord'),
                xodangWord: document.getElementById('xodangWord'),
                recordAudioBtn: document.getElementById('recordAudioBtn'),
                uploadAudioBtn: document.getElementById('uploadAudioBtn'),
                audioFileInput: document.getElementById('audioFileInput'),
                audioVisualizer: document.getElementById('audioVisualizer'),
                audioWave: document.getElementById('audioWave'),
                singlePlaybackControls: document.getElementById('singlePlaybackControls'),
                singlePlayAudioBtn: document.getElementById('singlePlayAudioBtn'),
                singleStopAudioBtn: document.getElementById('singleStopAudioBtn'),
                singleDeleteAudioBtn: document.getElementById('singleDeleteAudioBtn'),
                singleAudioFileName: document.getElementById('singleAudioFileName'),
                audioStatus: document.getElementById('audioStatus'),
                submitSingleBtn: document.getElementById('submitSingleBtn'),
                recordBatchBtn: document.getElementById('recordBatchBtn'),
                uploadBatchBtn: document.getElementById('uploadBatchBtn'),
                batchAudioInput: document.getElementById('batchAudioInput'),
                batchVisualizer: document.getElementById('batchVisualizer'),
                batchWave: document.getElementById('batchWave'),
                batchStatus: document.getElementById('batchStatus'),
                batchQueueList: document.getElementById('batchQueueList'),
                submitBatchBtn: document.getElementById('submitBatchBtn')
            };
            
            // ===== UTILITY FUNCTIONS =====
            function showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                toastContainer.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            function showLoading(message = 'Đang xử lý...') {
                const overlay = document.getElementById('loadingOverlay');
                const text = document.getElementById('loadingText');
                text.textContent = message;
                overlay.classList.remove('hidden');
            }
            
            function hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.classList.add('hidden');
            }
            
            function sanitizeFilename(text) {
                return text
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/đ/g, 'd')
                    .replace(/Đ/g, 'D')
                    .replace(/[^a-zA-Z0-9]/g, '_')
                    .toLowerCase()
                    .substring(0, 30);
            }
            
            // ===== AUDIO VISUALIZER =====
            function initVisualizer(waveElement, isActive) {
                const bars = 50;
                waveElement.innerHTML = '';
                
                for (let i = 0; i < bars; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'audio-wave-bar';
                    bar.style.left = `${(i / bars) * 100}%`;
                    bar.style.height = isActive ? `${Math.random() * 80 + 20}%` : '0%';
                    waveElement.appendChild(bar);
                }
            }
            
            function updateVisualizer(waveElement, isActive, isPlaying) {
                const bars = waveElement.querySelectorAll('.audio-wave-bar');
                bars.forEach(bar => {
                    if (isActive && isPlaying) {
                        bar.style.height = `${Math.random() * 60 + 20}%`;
                        bar.classList.add('playing-wave');
                    } else if (isActive) {
                        bar.style.height = `${Math.random() * 80 + 20}%`;
                        bar.classList.remove('playing-wave');
                    } else {
                        bar.style.height = '0%';
                        bar.classList.remove('playing-wave');
                    }
                });
            }
            
            // Khởi tạo visualizer
            initVisualizer(dom.audioWave, false);
            initVisualizer(dom.batchWave, false);
            
            // ===== TAB MANAGEMENT =====
            document.querySelectorAll('.contribute-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    document.querySelectorAll('.contribute-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    dom.singleTab.style.display = tabId === 'single' ? 'block' : 'none';
                    dom.batchTab.style.display = tabId === 'batch' ? 'block' : 'none';
                    
                    currentTab = tabId;
                    
                    // Dừng mọi phát âm thanh khi chuyển tab
                    stopAllAudio();
                });
            });
            
            function stopAllAudio() {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                if (batchAudio) {
                    batchAudio.pause();
                    batchAudio.currentTime = 0;
                }
                
                isPlaying = false;
                isBatchPlaying = false;
                currentBatchPlayingIndex = -1;
                dom.singlePlayAudioBtn.innerHTML = '<i class="fas fa-play"></i>';
                dom.singlePlayAudioBtn.classList.remove('playing');
                
                // Dừng animation
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                if (batchAnimationId) {
                    cancelAnimationFrame(batchAnimationId);
                    batchAnimationId = null;
                }
                
                // Reset visualizer
                initVisualizer(dom.audioWave, false);
                initVisualizer(dom.batchWave, false);
                updateBatchUI();
            }
            
            // ===== AUDIO RECORDING FUNCTIONS =====
            async function startRecording(isBatch = false) {
                if (isRecording) {
                    stopRecording();
                    return;
                }
                
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    });
                    
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(audioChunks, { type: 'audio/webm' });
                        
                        if (!isBatch) {
                            audioBlob = blob;
                            dom.singlePlaybackControls.style.display = 'flex';
                            // ĐÃ SỬA: HIỂN THỊ THÔNG TIN RÕ RÀNG HƠN
                            dom.singleAudioFileName.textContent = '✅ Âm thanh đã thu thành công!';
                            dom.singleAudioFileName.style.color = '#27ae60';
                            dom.singleAudioFileName.style.fontWeight = 'bold';
                            dom.audioStatus.textContent = 'Âm thanh đã sẵn sàng để gửi';
                            dom.audioStatus.className = 'audio-status success';
                            dom.recordAudioBtn.classList.remove('recording');
                            dom.recordAudioBtn.innerHTML = '<i class="fas fa-microphone"></i> Thu âm';
                        } else {
                            const timestamp = new Date().toLocaleTimeString('vi-VN', { 
                                hour: '2-digit', 
                                minute: '2-digit',
                                second: '2-digit'
                            });
                            batchQueue.push({
                                id: Date.now(),
                                name: `Thu âm ${timestamp}`,
                                blob: blob,
                                size: `${(blob.size / 1024).toFixed(1)} KB`,
                                type: 'recording'
                            });
                            
                            updateBatchUI();
                            dom.recordBatchBtn.classList.remove('recording');
                            dom.recordBatchBtn.innerHTML = '<i class="fas fa-microphone"></i> Bắt đầu thu';
                            dom.batchStatus.innerHTML = `<span style="color:#27ae60; font-weight:bold;">✅ Đã thêm vào hàng đợi.</span> <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                        }
                        
                        if (animationId) {
                            cancelAnimationFrame(animationId);
                            animationId = null;
                        }
                        
                        stream.getTracks().forEach(track => track.stop());
                        
                        initVisualizer(isBatch ? dom.batchWave : dom.audioWave, false);
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    if (!isBatch) {
                        dom.recordAudioBtn.classList.add('recording');
                        dom.recordAudioBtn.innerHTML = '<i class="fas fa-stop"></i> Dừng thu';
                        dom.audioStatus.textContent = 'Đang thu âm... (Nhấn Dừng thu khi xong)';
                    } else {
                        dom.recordBatchBtn.classList.add('recording');
                        dom.recordBatchBtn.innerHTML = '<i class="fas fa-stop"></i> Dừng thu';
                        dom.batchStatus.textContent = 'Đang thu âm... (Nhấn Dừng thu khi xong)';
                    }
                    
                    function animate() {
                        updateVisualizer(isBatch ? dom.batchWave : dom.audioWave, true, false);
                        animationId = requestAnimationFrame(animate);
                    }
                    animate();
                    
                } catch (error) {
                    console.error('Lỗi khi thu âm:', error);
                    const errorMsg = error.message.includes('permission') ? 
                        'Cần cấp quyền truy cập microphone để thu âm' : 
                        'Lỗi khi thu âm: ' + error.message;
                    
                    if (!isBatch) {
                        dom.audioStatus.textContent = errorMsg;
                        dom.recordAudioBtn.classList.remove('recording');
                        dom.recordAudioBtn.innerHTML = '<i class="fas fa-microphone"></i> Thu âm';
                    } else {
                        dom.batchStatus.textContent = errorMsg;
                        dom.recordBatchBtn.classList.remove('recording');
                        dom.recordBatchBtn.innerHTML = '<i class="fas fa-microphone"></i> Bắt đầu thu';
                    }
                    showToast(errorMsg, 'error');
                }
            }
            
            function stopRecording() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;
                }
            }
            
            // ===== SINGLE TAB FUNCTIONS =====
            dom.recordAudioBtn.addEventListener('click', () => startRecording(false));
            
            dom.uploadAudioBtn.addEventListener('click', () => {
                dom.audioFileInput.click();
            });
            
            dom.audioFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('audio/')) {
                    showToast('Vui lòng chọn file âm thanh hợp lệ', 'error');
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) {
                    showToast('File quá lớn. Vui lòng chọn file nhỏ hơn 10MB', 'error');
                    return;
                }
                
                audioBlob = file;
                
                dom.singlePlaybackControls.style.display = 'flex';
                // ĐÃ SỬA: HIỂN THỊ THÔNG TIN RÕ RÀNG HƠN
                dom.singleAudioFileName.textContent = `✅ Đã tải lên: ${file.name}`;
                dom.singleAudioFileName.style.color = '#27ae60';
                dom.singleAudioFileName.style.fontWeight = 'bold';
                dom.audioStatus.textContent = 'File âm thanh đã sẵn sàng để gửi';
                dom.audioStatus.className = 'audio-status success';
                
                initVisualizer(dom.audioWave, false);
                
                showToast('Đã tải file âm thanh lên thành công', 'success');
            });
            
            dom.singlePlayAudioBtn.addEventListener('click', function() {
                if (!audioBlob) {
                    showToast('Chưa có file âm thanh', 'error');
                    return;
                }
                
                if (isPlaying) {
                    if (currentAudio) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                    }
                    isPlaying = false;
                    this.innerHTML = '<i class="fas fa-play"></i>';
                    this.classList.remove('playing');
                    dom.audioStatus.textContent = 'Đã dừng phát âm thanh';
                    dom.audioStatus.className = 'audio-status';
                    
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    initVisualizer(dom.audioWave, false);
                    return;
                }
                
                const audioUrl = URL.createObjectURL(audioBlob);
                currentAudio = new Audio(audioUrl);
                currentAudio.volume = 1.0;
                
                currentAudio.play();
                isPlaying = true;
                this.innerHTML = '<i class="fas fa-pause"></i>';
                this.classList.add('playing');
                dom.audioStatus.textContent = 'Đang phát âm thanh...';
                dom.audioStatus.className = 'audio-status';
                
                function animatePlay() {
                    updateVisualizer(dom.audioWave, true, true);
                    animationId = requestAnimationFrame(animatePlay);
                }
                animatePlay();
                
                currentAudio.onended = () => {
                    isPlaying = false;
                    dom.singlePlayAudioBtn.innerHTML = '<i class="fas fa-play"></i>';
                    dom.singlePlayAudioBtn.classList.remove('playing');
                    dom.audioStatus.textContent = 'Đã phát xong âm thanh';
                    dom.audioStatus.className = 'audio-status';
                    
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    initVisualizer(dom.audioWave, false);
                    
                    URL.revokeObjectURL(audioUrl);
                };
                
                currentAudio.onerror = () => {
                    showToast('Lỗi khi phát âm thanh', 'error');
                    isPlaying = false;
                    dom.singlePlayAudioBtn.innerHTML = '<i class="fas fa-play"></i>';
                    dom.singlePlayAudioBtn.classList.remove('playing');
                    dom.audioStatus.textContent = 'Lỗi phát âm thanh';
                    dom.audioStatus.className = 'audio-status';
                };
            });
            
            dom.singleStopAudioBtn.addEventListener('click', function() {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                isPlaying = false;
                dom.singlePlayAudioBtn.innerHTML = '<i class="fas fa-play"></i>';
                dom.singlePlayAudioBtn.classList.remove('playing');
                dom.audioStatus.textContent = 'Đã dừng phát âm thanh';
                dom.audioStatus.className = 'audio-status';
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                initVisualizer(dom.audioWave, false);
            });
            
            dom.singleDeleteAudioBtn.addEventListener('click', function() {
                if (audioBlob) {
                    audioBlob = null;
                    dom.singlePlaybackControls.style.display = 'none';
                    dom.audioFileInput.value = '';
                    dom.audioStatus.textContent = 'Đã xóa file âm thanh';
                    dom.audioStatus.className = 'audio-status';
                    showToast('Đã xóa file âm thanh', 'info');
                    
                    if (currentAudio) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                        isPlaying = false;
                        dom.singlePlayAudioBtn.innerHTML = '<i class="fas fa-play"></i>';
                        dom.singlePlayAudioBtn.classList.remove('playing');
                    }
                    
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    initVisualizer(dom.audioWave, false);
                }
            });
            
            // ===== BATCH TAB FUNCTIONS =====
            dom.recordBatchBtn.addEventListener('click', () => startRecording(true));
            
            dom.uploadBatchBtn.addEventListener('click', () => {
                dom.batchAudioInput.click();
            });
            
            dom.batchAudioInput.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                let addedCount = 0;
                
                files.forEach(file => {
                    if (!file.type.startsWith('audio/')) {
                        showToast(`File "${file.name}" không phải file âm thanh`, 'error');
                        return;
                    }
                    
                    if (file.size > 10 * 1024 * 1024) {
                        showToast(`File "${file.name}" quá lớn (>10MB)`, 'error');
                        return;
                    }
                    
                    batchQueue.push({
                        id: Date.now() + Math.random(),
                        name: file.name.replace(/\.[^/.]+$/, ""),
                        blob: file,
                        size: `${(file.size / 1024).toFixed(1)} KB`,
                        type: 'upload'
                    });
                    addedCount++;
                });
                
                if (addedCount > 0) {
                    updateBatchUI();
                    dom.batchStatus.innerHTML = `<span style="color:#27ae60; font-weight:bold;">✅ Đã thêm ${addedCount} file.</span> <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                    showToast(`Đã thêm ${addedCount} file vào hàng đợi`, 'success');
                }
                
                this.value = '';
            });
            
            // ===== BATCH QUEUE MANAGEMENT =====
            function updateBatchUI() {
                if (batchQueue.length === 0) {
                    dom.batchQueueList.style.display = 'none';
                    dom.submitBatchBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Gửi tất cả';
                    return;
                }
                
                dom.batchQueueList.style.display = 'block';
                dom.submitBatchBtn.innerHTML = `<i class="fas fa-paper-plane"></i> Gửi tất cả (${batchQueue.length})`;
                
                dom.batchQueueList.innerHTML = batchQueue.map((item, index) => `
                    <div class="queue-item">
                        <div class="queue-item-info">
                            <div class="queue-item-name">${item.name}</div>
                            <div class="queue-item-size">${item.size} • ${item.type === 'recording' ? 'Thu âm' : 'Tải lên'}</div>
                        </div>
                        <div class="queue-item-actions">
                            <button class="queue-play-btn ${currentBatchPlayingIndex === index ? 'playing' : ''}" 
                                    onclick="playBatchQueueItem(${index})" 
                                    title="${currentBatchPlayingIndex === index ? 'Tạm dừng' : 'Nghe'}">
                                <i class="fas ${currentBatchPlayingIndex === index ? 'fa-pause' : 'fa-play'}"></i>
                            </button>
                            <button class="queue-delete-btn" onclick="deleteQueueItem(${index})" title="Xóa">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            window.playBatchQueueItem = function(index) {
                if (index < 0 || index >= batchQueue.length) return;
                
                if (isBatchPlaying && currentBatchPlayingIndex !== index) {
                    stopBatchAudio();
                }
                
                if (isBatchPlaying && currentBatchPlayingIndex === index) {
                    stopBatchAudio();
                    return;
                }
                
                const item = batchQueue[index];
                const audioUrl = URL.createObjectURL(item.blob);
                batchAudio = new Audio(audioUrl);
                batchAudio.volume = 1.0;
                
                batchAudio.play();
                isBatchPlaying = true;
                currentBatchPlayingIndex = index;
                
                dom.batchStatus.innerHTML = `<span style="color:#27ae60; font-weight:bold;">🔊 Đang phát:</span> <span class="current-playing">${item.name}</span>`;
                
                function animatePlay() {
                    updateVisualizer(dom.batchWave, true, true);
                    batchAnimationId = requestAnimationFrame(animatePlay);
                }
                animatePlay();
                
                batchAudio.onended = () => {
                    isBatchPlaying = false;
                    currentBatchPlayingIndex = -1;
                    dom.batchStatus.innerHTML = `<span style="color:#27ae60; font-weight:bold;">✅ Phát xong:</span> ${item.name}. <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                    
                    if (batchAnimationId) {
                        cancelAnimationFrame(batchAnimationId);
                        batchAnimationId = null;
                    }
                    initVisualizer(dom.batchWave, false);
                    
                    updateBatchUI();
                    
                    URL.revokeObjectURL(audioUrl);
                };
                
                batchAudio.onerror = () => {
                    showToast(`Lỗi khi phát file "${item.name}"`, 'error');
                    isBatchPlaying = false;
                    currentBatchPlayingIndex = -1;
                    dom.batchStatus.innerHTML = `<span style="color:#e74c3c; font-weight:bold;">❌ Lỗi phát file.</span> <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                    
                    if (batchAnimationId) {
                        cancelAnimationFrame(batchAnimationId);
                        batchAnimationId = null;
                    }
                    initVisualizer(dom.batchWave, false);
                    
                    updateBatchUI();
                };
                
                updateBatchUI();
            };
            
            function stopBatchAudio() {
                if (batchAudio) {
                    batchAudio.pause();
                    batchAudio.currentTime = 0;
                }
                
                isBatchPlaying = false;
                currentBatchPlayingIndex = -1;
                dom.batchStatus.innerHTML = `<span style="color:#f39c12; font-weight:bold;">⏸️ Đã dừng phát.</span> <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                
                if (batchAnimationId) {
                    cancelAnimationFrame(batchAnimationId);
                    batchAnimationId = null;
                }
                initVisualizer(dom.batchWave, false);
                
                updateBatchUI();
            }
            
            window.deleteQueueItem = function(index) {
                if (index >= 0 && index < batchQueue.length) {
                    if (currentBatchPlayingIndex === index) {
                        stopBatchAudio();
                    }
                    
                    const itemName = batchQueue[index].name;
                    batchQueue.splice(index, 1);
                    
                    if (currentBatchPlayingIndex > index) {
                        currentBatchPlayingIndex--;
                    } else if (currentBatchPlayingIndex === index) {
                        currentBatchPlayingIndex = -1;
                        isBatchPlaying = false;
                    }
                    
                    updateBatchUI();
                    dom.batchStatus.innerHTML = `<span style="color:#f39c12; font-weight:bold;">🗑️ Đã xóa "${itemName}".</span> <span class="current-playing">Tổng: ${batchQueue.length} file</span>`;
                    showToast(`Đã xóa "${itemName}" khỏi hàng đợi`, 'info');
                }
            };
            
            // ===== FILE UPLOAD FUNCTIONS =====
            function convertBlobToBase64(blob) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            }
            
            async function sendFile(data) {
                try {
                    const base64Audio = await convertBlobToBase64(data.blob);
                    
                    const payload = {
                        type: data.type,
                        vietnamese: data.vietnamese || "",
                        xodang: data.xodang || "",
                        readingContent: data.readingContent || data.name || "",
                        audioData: base64Audio,
                        mimeType: data.blob.type || 'audio/webm',
                        filename: `${sanitizeFilename(data.filename || data.name)}_${Date.now()}.${data.blob.type.includes('mp3') ? 'mp3' : 'webm'}`
                    };
                    
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    return { success: true, message: 'File đã được gửi thành công' };
                    
                } catch (error) {
                    console.error('Lỗi khi gửi file:', error);
                    throw new Error(`Lỗi gửi file: ${error.message}`);
                }
            }
            
            // ===== SUBMIT FUNCTIONS =====
            dom.submitSingleBtn.addEventListener('click', async function() {
                const vietnamese = dom.vietnameseWord.value.trim();
                const xodang = dom.xodangWord.value.trim();
                
                if (!vietnamese || !xodang) {
                    showToast('Vui lòng nhập đầy đủ từ tiếng Việt và tiếng Xơ Đăng', 'error');
                    return;
                }
                
                if (!audioBlob) {
                    showToast('Vui lòng thu âm hoặc tải file âm thanh lên', 'error');
                    return;
                }
                
                showLoading('Đang gửi từ vựng...');
                
                try {
                    await sendFile({
                        type: 'vocab',
                        vietnamese: vietnamese,
                        xodang: xodang,
                        blob: audioBlob,
                        name: vietnamese,
                        filename: vietnamese
                    });
                    
                    showToast('Đã gửi từ vựng thành công! Cảm ơn bạn đã đóng góp.', 'success');
                    
                    // Reset form
                    dom.vietnameseWord.value = '';
                    dom.xodangWord.value = '';
                    audioBlob = null;
                    dom.singlePlaybackControls.style.display = 'none';
                    dom.audioFileInput.value = '';
                    dom.audioStatus.textContent = '';
                    dom.audioStatus.className = 'audio-status';
                    
                } catch (error) {
                    console.error('Lỗi gửi từ vựng:', error);
                    showToast('Lỗi khi gửi từ vựng: ' + error.message, 'error');
                } finally {
                    hideLoading();
                }
            });
            
            dom.submitBatchBtn.addEventListener('click', async function() {
                if (batchQueue.length === 0) {
                    showToast('Hàng đợi trống', 'error');
                    return;
                }
                
                if (isBatchPlaying) {
                    stopBatchAudio();
                }
                
                showLoading(`Đang gửi ${batchQueue.length} file...`);
                
                let successCount = 0;
                let failedCount = 0;
                const errors = [];
                
                for (let i = 0; i < batchQueue.length; i++) {
                    const item = batchQueue[i];
                    
                    try {
                        await sendFile({
                            type: 'voice',
                            readingContent: item.name,
                            blob: item.blob,
                            name: item.name,
                            filename: item.name
                        });
                        successCount++;
                        
                        document.getElementById('loadingText').textContent = 
                            `Đang gửi ${i+1}/${batchQueue.length} file (${successCount} thành công)...`;
                        
                    } catch (error) {
                        console.error(`Lỗi gửi file ${item.name}:`, error);
                        failedCount++;
                        errors.push(`${item.name}: ${error.message}`);
                    }
                }
                
                hideLoading();
                
                if (successCount === batchQueue.length) {
                    showToast(`Đã gửi thành công ${batchQueue.length} file! Cảm ơn bạn đã đóng góp.`, 'success');
                    
                    batchQueue = [];
                    currentBatchPlayingIndex = -1;
                    isBatchPlaying = false;
                    updateBatchUI();
                    dom.batchStatus.innerHTML = 'Chưa có file nào trong hàng đợi';
                    
                } else if (successCount > 0) {
                    showToast(`Đã gửi ${successCount}/${batchQueue.length} file thành công. ${failedCount} file thất bại.`, 'info');
                    
                    if (successCount > 0) {
                        batchQueue = [];
                        updateBatchUI();
                        dom.batchStatus.innerHTML = 'Đã xử lý xong hàng đợi';
                    }
                    
                    if (errors.length > 0) {
                        console.error('Chi tiết lỗi:', errors);
                    }
                } else {
                    showToast(`Gửi thất bại tất cả ${batchQueue.length} file. Vui lòng thử lại.`, 'error');
                }
            });
            
            // Khởi tạo UI hàng đợi
            updateBatchUI();
            
        })();

        // ===== CHAT WIDGET FUNCTIONALITY - ĐÃ SỬA THEO YÊU CẦU =====
        (function() {
            // Cấu hình
            const CHAT_CONFIG = {
                API_KEY: 'AIzaSyD757jS4SLR7-EzrPgrW9WrLQeD2DQExHw',
                SHEET_ID: '1Z59pDBu_tGwlYqUeS1-VJLpcHozp7LbxnC_-qhT3iHs',
                RANGE: 'chat!A2:B'
            };
            
            // Biến toàn cục
            let chatMessages = [];
            let isChatOpen = false;
            let isTyping = false;
            let chatQnA = []; // Mảng chứa các cặp câu hỏi và câu trả lời
            let randomQuestions = []; // 3 câu hỏi ngẫu nhiên ban đầu
            let usedQuestions = new Set(); // Lưu các câu hỏi đã sử dụng
            
            // DOM Elements
            const dom = {
                chatToggleBtn: document.getElementById('chatToggleBtn'),
                chatWindow: document.getElementById('chatWindow'),
                closeChatBtn: document.getElementById('closeChatBtn'),
                chatMessages: document.getElementById('chatMessages'),
                chatInput: document.getElementById('chatInput'),
                sendChatBtn: document.getElementById('sendChatBtn'),
                chatNotification: document.getElementById('chatNotification')
            };
            
            // Hàm tiện ích
            function formatTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            function formatDateTime() {
                const now = new Date();
                const date = now.toISOString().split('T')[0];
                const time = now.toTimeString().split(' ')[0];
                return `${date} ${time}`;
            }
            
            // Hiển thị tin nhắn
            function displayMessage(text, sender, time = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const timeHtml = time ? `<div class="message-time">${time}</div>` : `<div class="message-time">${formatTime()}</div>`;
                
                messageDiv.innerHTML = `
                    ${text}
                    ${timeHtml}
                `;
                
                dom.chatMessages.appendChild(messageDiv);
                dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
                
                // Lưu tin nhắn
                chatMessages.push({
                    text,
                    sender,
                    time: time || formatTime()
                });
            }
            
            // Hiển thị typing indicator
            function showTypingIndicator() {
                if (isTyping) return;
                
                isTyping = true;
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                
                dom.chatMessages.appendChild(typingDiv);
                dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
            }
            
            // Ẩn typing indicator
            function hideTypingIndicator() {
                isTyping = false;
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            // Tải dữ liệu chat từ Google Sheets
            async function loadChatData() {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${CHAT_CONFIG.SHEET_ID}/values/${CHAT_CONFIG.RANGE}?key=${CHAT_CONFIG.API_KEY}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`Lỗi kết nối: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data.values || data.values.length === 0) {
                        throw new Error('Không có dữ liệu');
                    }
                    
                    // Lưu dữ liệu vào mảng chatQnA
                    chatQnA = data.values.map(row => ({
                        question: row[0] ? row[0].trim() : '',
                        answer: row[1] ? row[1].trim() : ''
                    })).filter(item => item.question && item.answer);
                    
                    // Lấy 3 câu hỏi ngẫu nhiên
                    getRandomQuestions(3);
                    
                    return true;
                } catch (error) {
                    console.error('Lỗi khi tải dữ liệu chat:', error);
                    // Nếu không tải được, dùng dữ liệu mẫu
                    chatQnA = [
                        { question: 'Xin chào bằng tiếng Xơ Đăng là gì?', answer: 'Bơ rơ ha' },
                        { question: 'Cảm ơn tiếng Xơ Đăng nói thế nào?', answer: 'Hơ măn ơn' },
                        { question: 'Tạm biệt trong tiếng Xơ Đăng là gì?', answer: 'Brơi' },
                        { question: 'Bạn có khỏe không?', answer: 'Brơi ha mơ hă?' },
                        { question: 'Tôi khỏe, cảm ơn', answer: 'Brơi ha, hơ măn ơn' },
                        { question: 'Tên bạn là gì?', answer: 'Brơi pêng hơ rơ ha?' },
                        { question: 'Tên tôi là...', answer: 'Brơi pêng ha...' },
                        { question: 'Bạn bao nhiêu tuổi?', answer: 'Brơi năm hơ rơ ha?' }
                    ];
                    getRandomQuestions(3);
                    return false;
                }
            }
            
            // Lấy câu hỏi ngẫu nhiên
            function getRandomQuestions(count) {
                if (chatQnA.length === 0) return;
                
                // Lọc các câu hỏi chưa được sử dụng
                const availableQuestions = chatQnA.filter(q => !usedQuestions.has(q.question));
                
                // Nếu không đủ câu hỏi, reset usedQuestions
                if (availableQuestions.length < count) {
                    usedQuestions.clear();
                    availableQuestions.push(...chatQnA);
                }
                
                // Xáo trộn mảng
                const shuffled = [...availableQuestions].sort(() => 0.5 - Math.random());
                
                // Lấy count câu đầu tiên
                randomQuestions = shuffled.slice(0, count);
                
                // Đánh dấu các câu hỏi đã sử dụng
                randomQuestions.forEach(q => usedQuestions.add(q.question));
            }
            
            // Lấy một câu hỏi ngẫu nhiên mới
            function getNewRandomQuestion() {
                if (chatQnA.length === 0) return null;
                
                // Lọc các câu hỏi chưa được sử dụng
                const availableQuestions = chatQnA.filter(q => !usedQuestions.has(q.question));
                
                // Nếu không còn câu hỏi, reset usedQuestions
                if (availableQuestions.length === 0) {
                    usedQuestions.clear();
                    availableQuestions.push(...chatQnA);
                }
                
                // Lấy ngẫu nhiên một câu hỏi
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                const question = availableQuestions[randomIndex];
                
                // Đánh dấu đã sử dụng
                usedQuestions.add(question.question);
                
                return question;
            }
            
            // Hiển thị lời chào và 3 câu hỏi ngẫu nhiên
            function displayWelcomeWithQuestions() {
                // Xóa nội dung cũ
                dom.chatMessages.innerHTML = '';
                
                // Thêm lời chào
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'message bot';
                welcomeDiv.innerHTML = `
                    Xin chào! Tôi là trợ lý tiếng Xơ Đăng. Tôi có thể giúp bạn tìm hiểu về ngôn ngữ và văn hóa Xơ Đăng.
                    <div class="message-time">${formatTime()}</div>
                `;
                dom.chatMessages.appendChild(welcomeDiv);
                
                // Thêm 3 câu hỏi ngẫu nhiên dưới dạng các nút
                const questionsDiv = document.createElement('div');
                questionsDiv.className = 'welcome-message';
                questionsDiv.innerHTML = `
                    <h4><i class="fas fa-lightbulb"></i> Gợi ý câu hỏi:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center;">
                        ${randomQuestions.map(q => `
                            <button class="hashtag" style="font-size: 0.8rem; padding: 6px 12px; cursor: pointer;" 
                                    onclick="document.getElementById('chatInput').value='${q.question.replace(/'/g, "\\'")}'; document.getElementById('sendChatBtn').click();">
                                ${q.question}
                            </button>
                        `).join('')}
                    </div>
                `;
                dom.chatMessages.appendChild(questionsDiv);
                
                dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
            }
            
            // Tìm câu trả lời từ dữ liệu đã tải
            async function findAnswer(question) {
                // Nếu chưa có dữ liệu, tải dữ liệu
                if (chatQnA.length === 0) {
                    await loadChatData();
                }
                
                const normalizedQuestion = question.toLowerCase().trim();
                
                // Tìm kiếm trong chatQnA (khớp chính xác)
                for (const item of chatQnA) {
                    const sheetQuestion = item.question.toLowerCase().trim();
                    // Kiểm tra khớp chính xác
                    if (sheetQuestion === normalizedQuestion) {
                        return item.answer;
                    }
                }
                
                return null;
            }
            
            // Xử lý tin nhắn từ người dùng
            async function handleUserMessage(message) {
                // Hiển thị tin nhắn người dùng
                displayMessage(message, 'user');
                
                // Hiển thị typing indicator
                showTypingIndicator();
                
                // Tìm câu trả lời
                const answer = await findAnswer(message);
                
                // Ẩn typing indicator
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    if (answer) {
                        // Nếu tìm thấy câu trả lời
                        displayMessage(answer, 'bot');
                        
                        // Sau khi trả lời, lấy câu hỏi ngẫu nhiên mới
                        const newQuestion = getNewRandomQuestion();
                        if (newQuestion) {
                            setTimeout(() => {
                                const suggestionDiv = document.createElement('div');
                                suggestionDiv.className = 'welcome-message';
                                suggestionDiv.innerHTML = `
                                    <h4><i class="fas fa-lightbulb"></i> Bạn có thể hỏi tiếp:</h4>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center;">
                                        <button class="hashtag" style="font-size: 0.8rem; padding: 6px 12px; cursor: pointer;" 
                                                onclick="document.getElementById('chatInput').value='${newQuestion.question.replace(/'/g, "\\'")}'; document.getElementById('sendChatBtn').click();">
                                            ${newQuestion.question}
                                        </button>
                                    </div>
                                `;
                                dom.chatMessages.appendChild(suggestionDiv);
                                dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
                            }, 500);
                        }
                    } else {
                        // Nếu không tìm thấy, trả lời xin lỗi và gợi ý một câu hỏi ngẫu nhiên
                        const newQuestion = getNewRandomQuestion();
                        let apology = 'Xin lỗi, tôi không hiểu câu hỏi của bạn. ';
                        
                        if (newQuestion) {
                            apology += `Bạn có thể thử hỏi: "${newQuestion.question}"`;
                            
                            // Hiển thị nút gợi ý
                            setTimeout(() => {
                                const suggestionDiv = document.createElement('div');
                                suggestionDiv.className = 'welcome-message';
                                suggestionDiv.innerHTML = `
                                    <h4><i class="fas fa-lightbulb"></i> Gợi ý:</h4>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center;">
                                        <button class="hashtag" style="font-size: 0.8rem; padding: 6px 12px; cursor: pointer;" 
                                                onclick="document.getElementById('chatInput').value='${newQuestion.question.replace(/'/g, "\\'")}'; document.getElementById('sendChatBtn').click();">
                                            ${newQuestion.question}
                                        </button>
                                    </div>
                                `;
                                dom.chatMessages.appendChild(suggestionDiv);
                                dom.chatMessages.scrollTop = dom.chatMessages.scrollHeight;
                            }, 100);
                        } else {
                            apology += 'Vui lòng thử lại với câu hỏi khác.';
                        }
                        
                        displayMessage(apology, 'bot');
                    }
                }, 1000 + Math.random() * 1000); // Thêm độ trễ tự nhiên
            }
            
            // Mở/đóng chat
            dom.chatToggleBtn.addEventListener('click', async () => {
                isChatOpen = !isChatOpen;
                dom.chatWindow.classList.toggle('active', isChatOpen);
                
                // Ẩn thông báo khi mở chat
                if (isChatOpen) {
                    dom.chatNotification.style.display = 'none';
                    
                    // Nếu chưa tải dữ liệu, thì tải
                    if (chatQnA.length === 0) {
                        await loadChatData();
                    }
                    
                    // Reset usedQuestions khi mở chat mới
                    usedQuestions.clear();
                    
                    // Lấy 3 câu hỏi ngẫu nhiên mới
                    getRandomQuestions(3);
                    
                    // Hiển thị lời chào và 3 câu hỏi ngẫu nhiên
                    displayWelcomeWithQuestions();
                    
                    // Focus vào input khi mở chat
                    setTimeout(() => {
                        dom.chatInput.focus();
                    }, 300);
                }
            });
            
            dom.closeChatBtn.addEventListener('click', () => {
                isChatOpen = false;
                dom.chatWindow.classList.remove('active');
            });
            
            // Gửi tin nhắn khi nhấn nút gửi
            dom.sendChatBtn.addEventListener('click', () => {
                const message = dom.chatInput.value.trim();
                if (message) {
                    dom.chatInput.value = '';
                    handleUserMessage(message);
                }
            });
            
            // Gửi tin nhắn khi nhấn Enter
            dom.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    dom.sendChatBtn.click();
                }
            });
            
            // Tự động mở chat khi có thông báo
            setTimeout(() => {
                // Chỉ hiển thị thông báo nếu chưa từng mở chat
                const hasOpenedChat = localStorage.getItem('hasOpenedChat');
                if (!hasOpenedChat) {
                    dom.chatNotification.style.display = 'flex';
                    localStorage.setItem('hasOpenedChat', 'true');
                }
            }, 5000);
            
            // Đóng chat khi click ra ngoài
            document.addEventListener('click', (e) => {
                if (isChatOpen && 
                    !dom.chatWindow.contains(e.target) && 
                    !dom.chatToggleBtn.contains(e.target)) {
                    isChatOpen = false;
                    dom.chatWindow.classList.remove('active');
                }
            });
            
            // Khởi tạo trạng thái ban đầu - tải dữ liệu ngay khi trang được tải
            loadChatData().then(() => {
                console.log('Chat widget đã sẵn sàng!');
            });
            
        })();

        // ===== HỌC VÀ KIỂM TRA FUNCTIONALITY (GỘP ÔN TẬP VÀ TRẮC NGHIỆM) - ĐÃ SỬA LOGIC VÀ THÊM ÂM THANH =====
        (function() {
            // Cấu hình
            const STUDY_QUIZ_CONFIG = {
                API_KEY: 'AIzaSyD757jS4SLR7-EzrPgrW9WrLQeD2DQExHw',
                SHEET_ID: '1Z59pDBu_tGwlYqUeS1-VJLpcHozp7LbxnC_-qhT3iHs',
                RANGE: 'Tracnghiem!A2:H' // A: STT, B: Câu hỏi, C-F: Đáp án, G: Đáp án đúng, H: Chủ đề
            };
            
            // Biến toàn cục
            let studyQuizData = [];
            let topics = new Map();
            let currentTopic = null;
            let currentStudyCards = []; // Thẻ học tập (flashcard)
            let currentStudyCardIndex = 0;
            let currentQuizQuestions = []; // Câu hỏi trắc nghiệm
            let currentQuestionIndex = 0;
            let userAnswers = new Array(5).fill(null);
            let quizTimer = null;
            let timeElapsed = 0;
            let studiedCards = new Set(); // Lưu các thẻ đã học - ĐÃ THAY ĐỔI: Lưu theo chủ đề
            let studySessionStarted = false;
            
            // Lưu trữ tiến độ học tập theo chủ đề
            let studyProgressByTopic = new Map();
            
            // Hàm phát âm thanh khi lật thẻ
            function playFlipSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 600;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (e) {
                    console.log("Không thể phát âm thanh lật thẻ: ", e);
                }
            }
            
            // DOM Elements
            const dom = {
                studyQuizTopicsGrid: document.getElementById('studyQuizTopicsGrid'),
                studyQuizTopicSelection: document.getElementById('studyQuizTopicSelection'),
                studyInterface: document.getElementById('studyInterface'),
                currentStudyTopicTitle: document.getElementById('currentStudyTopicTitle'),
                currentStudyCardNumber: document.getElementById('currentStudyCardNumber'),
                totalStudyCards: document.getElementById('totalStudyCards'),
                studyCompletion: document.getElementById('studyCompletion'),
                flashcard: document.getElementById('flashcard'),
                flashcardFront: document.getElementById('flashcardFront'),
                flashcardBack: document.getElementById('flashcardBack'),
                flashcardQuestion: document.getElementById('flashcardQuestion'),
                flashcardQuestionFull: document.getElementById('flashcardQuestionFull'),
                flashcardAnswer: document.getElementById('flashcardAnswer'),
                frontTick: document.getElementById('frontTick'),
                backTick: document.getElementById('backTick'),
                frontCardNumber: document.getElementById('frontCardNumber'),
                backCardNumber: document.getElementById('backCardNumber'),
                cardCompletionEffect: document.getElementById('cardCompletionEffect'),
                prevCardBtn: document.getElementById('prevCardBtn'),
                flipCardBtn: document.getElementById('flipCardBtn'),
                nextCardBtn: document.getElementById('nextCardBtn'),
                studyProgressFill: document.getElementById('studyProgressFill'),
                studySessionProgressFill: document.getElementById('studySessionProgressFill'),
                startQuizBtn: document.getElementById('startQuizBtn'),
                quizInterface: document.getElementById('quizInterface'),
                currentQuizTopicTitle: document.getElementById('currentQuizTopicTitle'),
                currentQuestionNumber: document.getElementById('currentQuestionNumber'),
                quizTimer: document.getElementById('quizTimer'),
                questionText: document.getElementById('questionText'),
                optionsContainer: document.getElementById('optionsContainer'),
                prevQuestionBtn: document.getElementById('prevQuestionBtn'),
                nextQuestionBtn: document.getElementById('nextQuestionBtn'),
                submitQuizBtn: document.getElementById('submitQuizBtn'),
                quizResult: document.getElementById('quizResult'),
                resultTopic: document.getElementById('resultTopic'),
                finalScore: document.getElementById('finalScore'),
                resultTitle: document.getElementById('resultTitle'),
                resultDescription: document.getElementById('resultDescription'),
                resultDetails: document.getElementById('resultDetails'),
                retryQuizBtn: document.getElementById('retryQuizBtn'),
                newTopicBtn: document.getElementById('newTopicBtn'),
                shareResultBtn: document.getElementById('shareResultBtn')
            };
            
            // Tiện ích
            function showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                toastContainer.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            function showLoading(message = 'Đang tải...') {
                const overlay = document.getElementById('loadingOverlay');
                const text = document.getElementById('loadingText');
                text.textContent = message;
                overlay.classList.remove('hidden');
            }
            
            function hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.classList.add('hidden');
            }
            
            // Format thời gian
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // Lấy dữ liệu từ Google Sheets
            async function fetchStudyQuizData() {
                try {
                    showLoading('Đang tải dữ liệu học tập...');
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${STUDY_QUIZ_CONFIG.SHEET_ID}/values/${STUDY_QUIZ_CONFIG.RANGE}?key=${STUDY_QUIZ_CONFIG.API_KEY}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error('Không thể tải dữ liệu học tập');
                    }
                    
                    const data = await response.json();
                    
                    if (!data.values || data.values.length === 0) {
                        throw new Error('Không có dữ liệu học tập');
                    }
                    
                    // Parse dữ liệu
                    studyQuizData = data.values.map(row => ({
                        id: row[0] || '',
                        question: row[1] || 'Câu hỏi',
                        options: [
                            row[2] || '',
                            row[3] || '',
                            row[4] || '',
                            row[5] || ''
                        ],
                        correctAnswer: parseInt(row[6]) || 1,
                        topic: row[7] || 'Khác'
                    }));
                    
                    // Nhóm theo chủ đề
                    studyQuizData.forEach(item => {
                        const topic = item.topic;
                        if (!topics.has(topic)) {
                            topics.set(topic, []);
                        }
                        topics.get(topic).push(item);
                    });
                    
                    // Hiển thị chủ đề
                    displayTopics();
                    
                    // Cập nhật số câu hỏi trong thống kê chính
                    const statQuestions = document.getElementById('stat-questions');
                    if (statQuestions) {
                        statQuestions.textContent = `${studyQuizData.length}+`;
                    }
                    
                    // Tải tiến độ học tập từ localStorage
                    loadStudyProgressFromStorage();
                    
                    showToast('Đã tải dữ liệu học tập thành công!', 'success');
                    
                } catch (error) {
                    console.error('Lỗi khi tải dữ liệu học tập:', error);
                    showToast('Không thể tải dữ liệu học tập. Vui lòng thử lại sau.', 'error');
                    // Hiển thị dữ liệu mẫu nếu không kết nối được
                    loadSampleData();
                } finally {
                    hideLoading();
                }
            }
            
            // Tải tiến độ học tập từ localStorage
            function loadStudyProgressFromStorage() {
                const savedProgress = localStorage.getItem('studyProgressByTopic');
                if (savedProgress) {
                    try {
                        const parsed = JSON.parse(savedProgress);
                        studyProgressByTopic = new Map(Object.entries(parsed));
                        
                        // Chuyển đổi Set từ string
                        studyProgressByTopic.forEach((cards, topic) => {
                            studyProgressByTopic.set(topic, new Set(JSON.parse(cards)));
                        });
                    } catch (e) {
                        console.error('Lỗi khi tải tiến độ học tập:', e);
                        studyProgressByTopic = new Map();
                    }
                }
            }
            
            // Lưu tiến độ học tập vào localStorage
            function saveStudyProgressToStorage() {
                const progressToSave = {};
                studyProgressByTopic.forEach((cards, topic) => {
                    progressToSave[topic] = JSON.stringify(Array.from(cards));
                });
                localStorage.setItem('studyProgressByTopic', JSON.stringify(progressToSave));
            }
            
            // Dữ liệu mẫu khi không kết nối được API
            function loadSampleData() {
                const sampleData = [
                    {
                        id: '1',
                        question: 'Xin chào trong tiếng Xơ Đăng là gì?',
                        options: ['Bơ rơ ha', 'Hơ măn ơn', 'Ka me', 'Brơi'],
                        correctAnswer: 1,
                        topic: 'Chào hỏi'
                    },
                    {
                        id: '2',
                        question: 'Cảm ơn trong tiếng Xơ Đăng là gì?',
                        options: ['Bơ rơ ha', 'Hơ măn ơn', 'Ka me', 'Brơi'],
                        correctAnswer: 2,
                        topic: 'Chào hỏi'
                    },
                    {
                        id: '3',
                        question: 'Tạm biệt trong tiếng Xơ Đăng là gì?',
                        options: ['Bơ rơ ha', 'Hơ măn ơn', 'Ka me', 'Brơi'],
                        correctAnswer: 4,
                        topic: 'Chào hỏi'
                    },
                    {
                        id: '4',
                        question: 'Con mèo trong tiếng Xơ Đăng là gì?',
                        options: ['Kon meo', 'Kon chó', 'Kon trâu', 'Kon gà'],
                        correctAnswer: 1,
                        topic: 'Động vật'
                    },
                    {
                        id: '5',
                        question: 'Con gà trong tiếng Xơ Đăng là gì?',
                        options: ['Kon meo', 'Kon chó', 'Kon trâu', 'Kon gà'],
                        correctAnswer: 4,
                        topic: 'Động vật'
                    },
                    {
                        id: '6',
                        question: 'Ăn cơm trong tiếng Xơ Đăng là gì?',
                        options: ['Hriăl hiam', 'Ka me', 'Brơi mprong', 'Hriăl mprong'],
                        correctAnswer: 2,
                        topic: 'Ẩm thực'
                    },
                    {
                        id: '7',
                        question: 'Uống nước trong tiếng Xơ Đăng là gì?',
                        options: ['Hriăl đăk', 'Ka đăk', 'Brơi đăk', 'Hriăl rơgong'],
                        correctAnswer: 1,
                        topic: 'Ẩm thực'
                    },
                    {
                        id: '8',
                        question: 'Nhà rông trong tiếng Xơ Đăng là gì?',
                        options: ['Hơnual rông', 'Hơnual nhỏ', 'Hơnual bleh', 'Hơnual mơnâm'],
                        correctAnswer: 1,
                        topic: 'Văn hóa'
                    },
                    {
                        id: '9',
                        question: 'Lễ hội trong tiếng Xơ Đăng là gì?',
                        options: ['Tơ ring', 'Brơi', 'Hriăl', 'Ka me'],
                        correctAnswer: 1,
                        topic: 'Văn hóa'
                    },
                    {
                        id: '10',
                        question: 'Trang phục truyền thống trong tiếng Xơ Đăng là gì?',
                        options: ['Bộ pơng', 'Bộ bleh', 'Bộ rông', 'Bộ mơnâm'],
                        correctAnswer: 1,
                        topic: 'Văn hóa'
                    }
                ];
                
                studyQuizData = sampleData;
                sampleData.forEach(item => {
                    const topic = item.topic;
                    if (!topics.has(topic)) {
                        topics.set(topic, []);
                    }
                    topics.get(topic).push(item);
                });
                
                displayTopics();
                
                // Cập nhật số câu hỏi trong thống kê chính
                const statQuestions = document.getElementById('stat-questions');
                if (statQuestions) {
                    statQuestions.textContent = `${studyQuizData.length}+`;
                }
                
                // Tải tiến độ học tập từ localStorage
                loadStudyProgressFromStorage();
            }
            
            // Hiển thị các chủ đề
            function displayTopics() {
                dom.studyQuizTopicsGrid.innerHTML = '';
                
                topics.forEach((questions, topicName) => {
                    // Lấy tiến độ học tập của chủ đề này
                    const studiedCards = studyProgressByTopic.get(topicName) || new Set();
                    const progressPercentage = questions.length > 0 ? Math.round((studiedCards.size / questions.length) * 100) : 0;
                    
                    const topicCard = document.createElement('div');
                    topicCard.className = 'study-quiz-topic-card';
                    topicCard.innerHTML = `
                        <i class="fas fa-folder"></i>
                        <h3>${topicName}</h3>
                        <p>${questions.length} câu hỏi</p>
                        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #27ae60; font-weight: 600;">
                            ${progressPercentage}% đã học
                        </div>
                    `;
                    
                    topicCard.addEventListener('click', () => selectTopic(topicName));
                    dom.studyQuizTopicsGrid.appendChild(topicCard);
                });
            }
            
            // Chọn chủ đề
            function selectTopic(topicName) {
                currentTopic = topicName;
                
                // Reset trạng thái học tập cho phiên hiện tại
                currentStudyCardIndex = 0;
                studySessionStarted = false;
                
                // Lấy tất cả câu hỏi của chủ đề
                const allQuestions = topics.get(topicName);
                currentStudyCards = allQuestions.map((q, index) => ({
                    index: index, // Lưu index gốc để theo dõi
                    question: q.question,
                    answer: q.options[q.correctAnswer - 1], // Đáp án đúng
                    fullQuestion: q.question // Lưu câu hỏi đầy đủ
                }));
                
                // Xáo trộn thẻ học tập
                currentStudyCards = shuffleArray(currentStudyCards);
                
                // Lấy tiến độ đã học của chủ đề này
                const savedStudiedCards = studyProgressByTopic.get(topicName) || new Set();
                studiedCards = savedStudiedCards;
                
                // Hiển thị giao diện học tập
                dom.studyQuizTopicSelection.style.display = 'none';
                dom.studyInterface.style.display = 'block';
                dom.quizInterface.style.display = 'none';
                dom.quizResult.style.display = 'none';
                
                // Cập nhật thông tin
                dom.currentStudyTopicTitle.textContent = `Chủ đề: ${topicName}`;
                dom.totalStudyCards.textContent = currentStudyCards.length;
                
                // Hiển thị thẻ đầu tiên
                displayStudyCard();
                
                // Cập nhật tiến độ học tập
                updateStudyProgress();
            }
            
            // Xáo trộn mảng
            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
            
            // Hiển thị thẻ học tập - ĐÃ SỬA LỖI HIỂN THỊ SỐ THỨ TỰ
            function displayStudyCard() {
                const card = currentStudyCards[currentStudyCardIndex];
                const isStudied = studiedCards.has(card.index);
                const totalCards = currentStudyCards.length;
                const currentCardNumber = currentStudyCardIndex + 1;
                
                // Cập nhật số thẻ
                dom.currentStudyCardNumber.textContent = currentCardNumber;
                
                // Cập nhật số thứ tự trên thẻ (cả hai mặt)
                // FIX: Sửa lỗi hiển thị số thứ tự trên mặt sau
                const frontNumberText = `${currentCardNumber}/${totalCards}`;
                const backNumberText = `${currentCardNumber}/${totalCards}`;
                
                dom.frontCardNumber.textContent = frontNumberText;
                dom.backCardNumber.textContent = backNumberText;
                
                // Thêm hiệu ứng cho số thứ tự nếu thẻ đã học
                if (isStudied) {
                    dom.frontCardNumber.classList.add('completed');
                    dom.backCardNumber.classList.add('completed');
                } else {
                    dom.frontCardNumber.classList.remove('completed');
                    dom.backCardNumber.classList.remove('completed');
                }
                
                // Hiển thị câu hỏi
                dom.flashcardQuestion.textContent = card.question;
                dom.flashcardQuestionFull.textContent = card.fullQuestion; // Hiển thị câu hỏi đầy đủ
                
                // Hiển thị đáp án
                dom.flashcardAnswer.textContent = card.answer;
                
                // Hiển thị/ẩn dấu tick
                if (isStudied) {
                    dom.frontTick.classList.add('visible');
                    dom.backTick.classList.add('visible');
                } else {
                    dom.frontTick.classList.remove('visible');
                    dom.backTick.classList.remove('visible');
                }
                
                // Reset thẻ về mặt trước
                dom.flashcard.classList.remove('flipped');
                dom.flashcard.classList.remove('completed-card');
                
                // Cập nhật nút điều khiển
                dom.prevCardBtn.disabled = currentStudyCardIndex === 0;
                dom.nextCardBtn.disabled = currentStudyCardIndex === currentStudyCards.length - 1;
                
                // Cập nhật tiến độ phiên học
                const sessionProgress = ((currentStudyCardIndex + 1) / currentStudyCards.length) * 100;
                dom.studySessionProgressFill.style.width = `${sessionProgress}%`;
                
                // Thêm hiệu ứng chuyển thẻ
                setTimeout(() => {
                    if (currentStudyCardIndex > 0) {
                        dom.flashcard.classList.add('prev-card');
                        setTimeout(() => {
                            dom.flashcard.classList.remove('prev-card');
                        }, 500);
                    } else if (currentStudyCardIndex < currentStudyCards.length - 1) {
                        dom.flashcard.classList.add('next-card');
                        setTimeout(() => {
                            dom.flashcard.classList.remove('next-card');
                        }, 500);
                    }
                }, 10);
            }
            
            // Cập nhật tiến độ học tập tổng thể
            function updateStudyProgress() {
                const totalCards = currentStudyCards.length;
                const studiedCount = studiedCards.size;
                const progressPercentage = totalCards > 0 ? Math.round((studiedCount / totalCards) * 100) : 0;
                
                // Cập nhật thanh tiến độ
                dom.studyProgressFill.style.width = `${progressPercentage}%`;
                dom.studyCompletion.textContent = `${progressPercentage}% đã học`;
                
                // Kích hoạt nút bắt đầu kiểm tra nếu đã học đủ
                if (progressPercentage >= 70) {
                    dom.startQuizBtn.disabled = false;
                    dom.startQuizBtn.innerHTML = '<i class="fas fa-play-circle"></i> Bắt đầu kiểm tra';
                } else {
                    dom.startQuizBtn.disabled = true;
                    dom.startQuizBtn.innerHTML = `<i class="fas fa-play-circle"></i> Bắt đầu kiểm tra (cần học thêm ${70 - progressPercentage}%)`;
                }
                
                // Lưu tiến độ vào localStorage
                studyProgressByTopic.set(currentTopic, studiedCards);
                saveStudyProgressToStorage();
            }
            
            // Đánh dấu thẻ đã học
            function markCardAsStudied() {
                const card = currentStudyCards[currentStudyCardIndex];
                if (!studiedCards.has(card.index)) {
                    studiedCards.add(card.index);
                    
                    // Hiển thị dấu tick
                    dom.frontTick.classList.add('visible');
                    dom.backTick.classList.add('visible');
                    
                    // Thêm hiệu ứng cho số thứ tự
                    dom.frontCardNumber.classList.add('completed');
                    dom.backCardNumber.classList.add('completed');
                    
                    // Kích hoạt hiệu ứng hoàn thành
                    dom.cardCompletionEffect.classList.add('active');
                    setTimeout(() => {
                        dom.cardCompletionEffect.classList.remove('active');
                    }, 1500);
                    
                    // Thêm hiệu ứng cho thẻ
                    dom.flashcard.classList.add('completed-card');
                    setTimeout(() => {
                        dom.flashcard.classList.remove('completed-card');
                    }, 1000);
                    
                    // Cập nhật tiến độ
                    updateStudyProgress();
                    
                    // Phát âm thanh hoàn thành
                    playFlipSound();
                }
            }
            
            // Các nút điều khiển học tập
            dom.prevCardBtn.addEventListener('click', () => {
                if (currentStudyCardIndex > 0) {
                    currentStudyCardIndex--;
                    displayStudyCard();
                }
            });
            
            dom.nextCardBtn.addEventListener('click', () => {
                if (currentStudyCardIndex < currentStudyCards.length - 1) {
                    currentStudyCardIndex++;
                    displayStudyCard();
                }
            });
            
            dom.flipCardBtn.addEventListener('click', () => {
                dom.flashcard.classList.toggle('flipped');
                studySessionStarted = true;
                markCardAsStudied();
                playFlipSound(); // Phát âm thanh khi lật thẻ
            });
            
            // Lật thẻ khi click vào thẻ
            dom.flashcard.addEventListener('click', (e) => {
                // Chỉ lật thẻ khi click vào thẻ, không phải vào nút
                if (!e.target.closest('.flashcard-nav-btn') && !e.target.closest('.flashcard-flip-btn') && !e.target.closest('.flashcard-number')) {
                    dom.flashcard.classList.toggle('flipped');
                    studySessionStarted = true;
                    markCardAsStudied();
                    playFlipSound(); // Phát âm thanh khi lật thẻ
                }
            });
            
            // Bắt đầu kiểm tra
            dom.startQuizBtn.addEventListener('click', () => {
                // Kiểm tra xem đã học đủ chưa
                const studiedCount = studiedCards.size;
                const totalCards = currentStudyCards.length;
                const progressPercentage = totalCards > 0 ? Math.round((studiedCount / totalCards) * 100) : 0;
                
                if (progressPercentage < 70) {
                    showToast(`Bạn cần học ít nhất 70% để bắt đầu kiểm tra. Hiện tại: ${progressPercentage}%`, 'error');
                    return;
                }
                
                // Lấy 5 câu hỏi ngẫu nhiên từ chủ đề
                const allQuestions = topics.get(currentTopic);
                currentQuizQuestions = getRandomQuestions(allQuestions, 5);
                currentQuestionIndex = 0;
                userAnswers = new Array(5).fill(null);
                timeElapsed = 0;
                
                // Hiển thị giao diện kiểm tra
                dom.studyInterface.style.display = 'none';
                dom.quizInterface.style.display = 'block';
                
                // Cập nhật thông tin
                dom.currentQuizTopicTitle.textContent = `Chủ đề: ${currentTopic}`;
                
                // Bắt đầu bộ đếm thời gian
                startTimer();
                
                // Hiển thị câu hỏi đầu tiên
                displayQuestion();
            });
            
            // Lấy câu hỏi ngẫu nhiên
            function getRandomQuestions(questions, count) {
                const shuffled = [...questions].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }
            
            // Bộ đếm thời gian
            function startTimer() {
                if (quizTimer) clearInterval(quizTimer);
                
                quizTimer = setInterval(() => {
                    timeElapsed++;
                    dom.quizTimer.textContent = formatTime(timeElapsed);
                }, 1000);
            }
            
            // Hiển thị câu hỏi
            function displayQuestion() {
                const question = currentQuizQuestions[currentQuestionIndex];
                
                // Cập nhật số câu hỏi
                dom.currentQuestionNumber.textContent = currentQuestionIndex + 1;
                
                // Hiển thị câu hỏi
                dom.questionText.textContent = question.question;
                
                // Hiển thị các lựa chọn
                dom.optionsContainer.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    if (userAnswers[currentQuestionIndex] === index + 1) {
                        optionDiv.classList.add('selected');
                    }
                    
                    optionDiv.innerHTML = `
                        <input type="radio" name="quizOption" id="option${index + 1}" value="${index + 1}"
                               ${userAnswers[currentQuestionIndex] === index + 1 ? 'checked' : ''}>
                        <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                        <span class="option-text">${option}</span>
                    `;
                    
                    optionDiv.addEventListener('click', () => selectOption(index + 1));
                    dom.optionsContainer.appendChild(optionDiv);
                });
                
                // Cập nhật nút điều khiển
                dom.prevQuestionBtn.disabled = currentQuestionIndex === 0;
                dom.nextQuestionBtn.disabled = currentQuestionIndex === currentQuizQuestions.length - 1;
                dom.submitQuizBtn.disabled = userAnswers.includes(null);
            }
            
            // Chọn đáp án
            function selectOption(optionIndex) {
                userAnswers[currentQuestionIndex] = optionIndex;
                
                // Cập nhật giao diện
                const options = document.querySelectorAll('.option');
                options.forEach((option, index) => {
                    option.classList.remove('selected');
                    const input = option.querySelector('input');
                    if (input.value == optionIndex) {
                        option.classList.add('selected');
                        input.checked = true;
                    }
                });
                
                // Kích hoạt nút nộp bài nếu tất cả câu đã được trả lời
                dom.submitQuizBtn.disabled = userAnswers.includes(null);
            }
            
            // Chuyển câu hỏi
            dom.prevQuestionBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    displayQuestion();
                }
            });
            
            dom.nextQuestionBtn.addEventListener('click', () => {
                if (currentQuestionIndex < currentQuizQuestions.length - 1) {
                    currentQuestionIndex++;
                    displayQuestion();
                }
            });
            
            // Nộp bài
            dom.submitQuizBtn.addEventListener('click', () => {
                // Kiểm tra xem đã trả lời hết chưa
                if (userAnswers.includes(null)) {
                    showToast('Vui lòng trả lời tất cả các câu hỏi trước khi nộp bài!', 'error');
                    return;
                }
                
                // Dừng bộ đếm thời gian
                if (quizTimer) {
                    clearInterval(quizTimer);
                    quizTimer = null;
                }
                
                // Tính điểm
                calculateScore();
            });
            
            // Tính điểm
            function calculateScore() {
                let score = 0;
                const results = [];
                
                currentQuizQuestions.forEach((question, index) => {
                    const userAnswer = userAnswers[index];
                    const isCorrect = userAnswer === question.correctAnswer;
                    
                    if (isCorrect) {
                        score++;
                    }
                    
                    results.push({
                        question: question.question,
                        userAnswer: userAnswer,
                        correctAnswer: question.correctAnswer,
                        options: question.options,
                        isCorrect: isCorrect
                    });
                });
                
                // Hiển thị kết quả
                showResults(score, results);
            }
            
            // Hiển thị kết quả
            function showResults(score, results) {
                dom.quizInterface.style.display = 'none';
                dom.quizResult.style.display = 'block';
                
                // Cập nhật thông tin
                dom.resultTopic.textContent = `Chủ đề: ${currentTopic}`;
                dom.finalScore.textContent = score;
                
                // Đánh giá
                let title = '';
                let description = '';
                
                if (score === 5) {
                    title = 'Xuất sắc! 🎉';
                    description = 'Bạn đã nắm vững kiến thức về chủ đề này. Tiếp tục phát huy nhé!';
                } else if (score >= 4) {
                    title = 'Rất tốt! 👍';
                    description = 'Kiến thức của bạn khá vững. Hãy ôn tập thêm để đạt điểm tuyệt đối!';
                } else if (score >= 3) {
                    title = 'Khá ổn! 👌';
                    description = 'Bạn đã nắm được kiến thức cơ bản. Hãy học thêm để tiến bộ hơn.';
                } else {
                    title = 'Cần cố gắng thêm! 💪';
                    description = 'Đừng nản lòng! Hãy quay lại học tập và thử lại lần nữa.';
                }
                
                dom.resultTitle.textContent = title;
                dom.resultDescription.textContent = description;
                
                // Hiển thị chi tiết từng câu
                dom.resultDetails.innerHTML = '';
                results.forEach((result, index) => {
                    const detailItem = document.createElement('div');
                    detailItem.className = `detail-item ${result.isCorrect ? 'correct' : 'incorrect'}`;
                    
                    const userAnswerText = result.options[result.userAnswer - 1];
                    const correctAnswerText = result.options[result.correctAnswer - 1];
                    
                    detailItem.innerHTML = `
                        <div class="detail-question">Câu ${index + 1}: ${result.question}</div>
                        <div class="detail-answer ${result.isCorrect ? 'correct' : 'incorrect'}">
                            ${result.isCorrect ? '✅' : '❌'} 
                            Đáp án của bạn: ${userAnswerText}
                            ${!result.isCorrect ? `<br>Đáp án đúng: ${correctAnswerText}` : ''}
                        </div>
                    `;
                    
                    dom.resultDetails.appendChild(detailItem);
                });
            }
            
            // Các nút hành động
            dom.retryQuizBtn.addEventListener('click', () => {
                // Làm lại với cùng chủ đề
                selectTopic(currentTopic);
            });
            
            dom.newTopicBtn.addEventListener('click', () => {
                // Quay lại chọn chủ đề
                dom.quizResult.style.display = 'none';
                dom.studyQuizTopicSelection.style.display = 'block';
                
                // Hiển thị lại các chủ đề với tiến độ cập nhật
                displayTopics();
            });
            
            dom.shareResultBtn.addEventListener('click', () => {
                const score = parseInt(dom.finalScore.textContent);
                const message = `Tôi vừa đạt ${score}/5 điểm trong bài kiểm tra tiếng Xơ Đăng chủ đề "${currentTopic}"! 🎯\n\nThử thách bản thân tại: ${window.location.href}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Kết quả kiểm tra tiếng Xơ Đăng',
                        text: message,
                        url: window.location.href
                    }).catch(console.error);
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(message).then(() => {
                        showToast('Đã sao chép kết quả vào clipboard!', 'success');
                    }).catch(() => {
                        // Fallback nếu clipboard không hoạt động
                        prompt('Sao chép đoạn text sau để chia sẻ:', message);
                    });
                }
            });
            
            // Khởi tạo
            function initStudyQuiz() {
                fetchStudyQuizData();
                
                // Xử lý khi chuyển đến section học và kiểm tra
                const quizLink = document.querySelector('a[href="#quiz"]');
                if (quizLink) {
                    quizLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        showSection('quiz');
                        
                        // Nếu chưa tải dữ liệu thì tải
                        if (studyQuizData.length === 0) {
                            fetchStudyQuizData();
                        }
                    });
                }
            }
            
            // Khởi động khi trang được tải
            document.addEventListener('DOMContentLoaded', initStudyQuiz);
        })();

        // ===== THÊM VÀO FOOTER - PWA STATUS =====
        window.addEventListener('load', () => {
            // Kiểm tra PWA status
            const pwaStatus = document.createElement('div');
            pwaStatus.style.cssText = 'margin-top: 1rem; font-size: 0.85rem; color: #666; text-align: center;';
            
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                pwaStatus.innerHTML = '<i class="fas fa-check-circle" style="color: #27ae60;"></i> Ứng dụng PWA đã sẵn sàng (có thể cài đặt & hoạt động offline)';
            } else {
                pwaStatus.innerHTML = '<i class="fas fa-info-circle" style="color: #f39c12;"></i> Một số tính năng PWA có thể không khả dụng trên trình duyệt này';
            }
            
            document.querySelector('.footer-content').appendChild(pwaStatus);
        });

	// ===== XỬ LÝ MỞ GAME TRONG TAB MỚI =====
document.addEventListener('DOMContentLoaded', function() {
    // Xử lý click vào menu Game học tập
    const gameLinks = document.querySelectorAll('a[href="https://tudienxedang.github.io/tudien/game.html"]');
    
    gameLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // Ngăn hành vi mặc định
            e.preventDefault();
            
            // Mở tab mới
            window.open(
                'https://tudienxedang.github.io/tudien/game.html',
                '_blank',
                'noopener,noreferrer'
            );
            
            // Luôn quay lại trang chủ
            showSection('home');
        });
    });
});
    </script>


<script>
// ===== LOADING SCREEN MANAGEMENT =====
document.addEventListener('DOMContentLoaded', function() {
    // Kiểm tra xem đã xem intro chưa
    const hasSeenIntro = localStorage.getItem('hasSeenIntro');
    
    // Nếu đã xem intro rồi (lần thứ 2 trở đi)
    if (hasSeenIntro === 'true') {
        showAppLoading();
    }
    
    // Lưu lại rằng đã vào ứng dụng (để lần sau biết là đã xem intro)
    localStorage.setItem('hasSeenIntro', 'true');
});

function showAppLoading() {
    const loadingScreen = document.getElementById('app-loading');
    
    // Hiển thị loading screen
    loadingScreen.style.display = 'flex';
    
    // Giả lập thời gian loading (3 giây)
    let progress = 0;
    const progressBar = document.querySelector('.loading-bar');
    const interval = setInterval(() => {
        progress += 1;
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            
            // Ẩn loading screen sau khi hoàn thành
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                loadingScreen.style.transition = 'opacity 0.5s ease';
                
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    
                    // Thông báo loading hoàn thành (cho các script khác biết)
                    window.dispatchEvent(new Event('appLoadingComplete'));
                    
                    // Hiển thị chat widget nếu có
                    const chatToggleBtn = document.getElementById('chatToggleBtn');
                    if (chatToggleBtn) {
                        setTimeout(() => {
                            chatToggleBtn.style.display = 'flex';
                        }, 500);
                    }
                }, 500);
            }, 500);
        }
    }, 30);
}







	

// Nếu muốn bỏ qua loading (cho debug)
window.skipLoading = function() {
    const loadingScreen = document.getElementById('app-loading');
    loadingScreen.style.display = 'none';
    window.dispatchEvent(new Event('appLoadingComplete'));
};

// Tự động ẩn loading nếu ứng dụng tải quá lâu (10 giây)
setTimeout(() => {
    const loadingScreen = document.getElementById('app-loading');
    if (loadingScreen && loadingScreen.style.display !== 'none') {
        loadingScreen.style.display = 'none';
        window.dispatchEvent(new Event('appLoadingComplete'));
    }
}, 10000);

// ===== KIỂM TRA OFFLINE CHO GAME =====
function checkGameAvailable() {
    if (!navigator.onLine) {
        // Kiểm tra nếu game.html đã được cache
        caches.match('./game.html').then(response => {
            if (response) {
                console.log('Game đã được cache, có thể mở offline');
                return true;
            } else {
                showToast('⚠️ Bạn đang offline. Game chỉ khả dụng khi có kết nối internet.', 'error');
                return false;
            }
        }).catch(() => {
            showToast('⚠️ Bạn đang offline. Game chỉ khả dụng khi có kết nối internet.', 'error');
            return false;
        });
    }
    return true;
}

// ===== SỬA LẠI SỰ KIỆN CLICK GAME =====
document.addEventListener('DOMContentLoaded', function() {
    const gameLinks = document.querySelectorAll('a[href="https://tudienxedang.github.io/tudien/game.html"]');
    
    gameLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // Nếu đang offline, kiểm tra cache trước
            if (!navigator.onLine) {
                e.preventDefault();
                
                caches.open('tudien-xodang-v3.2').then(cache => {
                    return cache.match('./game.html');
                }).then(response => {
                    if (response) {
                        // Nếu có cache, mở game
                        window.open(
                            'https://tudienxedang.github.io/tudien/game.html',
                            '_blank',
                            'noopener,noreferrer'
                        );
                    } else {
                        // Nếu không có cache, hiển thị thông báo
                        showToast('🎮 Game chỉ khả dụng khi có internet. Vui lòng kết nối mạng để chơi game.', 'error');
                        
                        // Hoặc có thể mở modal với thông báo
                        const modal = document.createElement('div');
                        modal.innerHTML = `
                            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                                <div style="background: white; padding: 2rem; border-radius: 10px; max-width: 400px; text-align: center;">
                                    <h3 style="color: #e74c3c; margin-bottom: 1rem;">📡 Cần kết nối Internet</h3>
                                    <p>Game học tập cần tải dữ liệu từ server. Vui lòng kết nối internet để chơi game.</p>
                                    <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">Các tính năng khác vẫn hoạt động offline.</p>
                                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 1.5rem; padding: 0.5rem 2rem; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                        Đã hiểu
                                    </button>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(modal);
                    }
                });
            }
        });
    });
});
	

</body>
	
</html>
